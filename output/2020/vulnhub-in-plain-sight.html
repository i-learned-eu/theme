<!DOCTYPE html>
<html lang="fr">
<head>
          <title>Blog - Eban - Vulnhub, In Plain Sight üìù</title>
        <meta charset="utf-8" />





        <link rel="stylesheet" href="/static/css/style.css">
</head>

<body id="index" class="home">
   <div class="header">
      <div class="nav"><a href="#">ACCUEIL</a><a href="contact">CONTACT</a><a href="about">A PROPOS</a></div>
      <h1>Eban's Blog</h1>
    </div>

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://10.0.0.11:8000/2020/vulnhub-in-plain-sight.html" rel="bookmark"
         title="Permalink to Vulnhub, In Plain Sight üìù">Vulnhub, In Plain Sight üìù</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2020-02-15T00:00:00+01:00">
      sam. 15 f√©vrier 2020
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="http://10.0.0.11:8000/author/eban.html">Eban</a>
    </address>
    <div class="category">
        Category: <a href="http://10.0.0.11:8000/category/misc.html">misc</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h1>Vulnhub : In Plain Sight üìù</h1>
<p>Pour ce second write-up, nous allons faire In Plain Sight qui est une box cr√©√©e par bzyo.<br>
<a href="https://www.vulnhub.com/entry/in-plain-sight-101,400/">Ici</a>, le lien pour la t√©l√©charger</p>
<h2>ENUMERATION</h2>
<p>Pour trouver l‚ÄôIP de notre box, on lance la commande suivante</p>
<blockquote>
<p>netdiscover</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/RVrS70vj/Capture-d-cran-de-2020-04-22-15-14-01.png"></p>
<p>On voit ici que nous avons notre cible en 192.168.1.40, on lance donc un scan nmap sur l‚ÄôIP de notre box, pour cela on lance la commande</p>
<blockquote>
<p>nmap -A 192.168.1.40</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/vZKxdsrM/Capture-d-cran-de-2020-04-22-15-16-53.png"></p>
<p>Nous avons donc, du SSH √† jour et sans faille connue, idem pour le serveur HTTP, ainsi qu'un serveur ftp ouvert avec, d'apr√®s nmap un fichier todo.txt accessible en lecture, la connexion en anonyme est autoris√©e sur le serveur ftp.<br>
On s'empresse donc d'aller voir du cot√© du serveur ftp, pour s'y connecter en anonyme on utilise la commande</p>
<blockquote>
<p>ftp 192.168.1.40</p>
</blockquote>
<p>On rentre donc anonymous en nom d'utilisateur et on ne met pas de mot de passe...</p>
<p><img alt="" src="https://i.postimg.cc/8PfnQhf0/Capture-d-cran-de-2020-04-22-15-22-54.png"></p>
<p>On utilise ensuite la commande</p>
<blockquote>
<p>dir</p>
</blockquote>
<p>Pour afficher les dossiers et fichiers pr√©sents dans le r√©pertoire courant (√©quivalent √† ls sous linux)</p>
<p><img alt="" src="https://i.postimg.cc/vmBTqHcb/Capture-d-cran-de-2020-04-22-15-26-03.png"></p>
<p>Nous voyons donc qu'il y a un fichier todo.txt qui nous est accessible en lecture.<br>
On le r√©cup√®re sur notre machine avec la commande</p>
<blockquote>
<p>get todo.txt</p>
</blockquote>
<p>On peut ensuite lire le fichier et voil√† ce qu'il contient</p>
<p><code>mike - please get ride of that worthless wordpress instance! it's a security risk. if you have privilege issues, please ask joe for assitance. &lt;br&gt;joe - stop leaving backdoors on the system or your access will be removed! your rabiit holes aren't enough for these elite cyber hacking types. - boss person</code></p>
<p>On comprend donc qu'il y a une instance wordpress vuln√©rable sur la machine cible ...<br>
On comprend aussi que l'utilisateur Joe a certains privileges sur notre machine cible.<br>
Regardons donc du c√¥t√© du serveur web.</p>
<p><img alt="" src="https://i.postimg.cc/SxyxR7Fg/Capture-d-cran-de-2020-04-22-15-36-57.png"></p>
<p>En regardant cette page, quelque chose m'intrigue, il est √©crit</p>
<p><code>located at /var/www/html/index.htnl</code></p>
<p>Alors qu'il devrait etre √©crit...</p>
<p><code>located at /var/www/html/index.html</code></p>
<p>Regardons donc ce fameux fichier index.htnl, et bingo ! On tombe sur une page contenant un gif cliquable qui renvoie vers un autre page</p>
<p><img alt="" src="https://i.postimg.cc/T1TWxyxS/Capture-d-cran-de-2020-04-22-15-41-18.png"></p>
<p>Allons voir vers quelle page nous envoie ce lien...<br>
Il nous renvoie donc vers une page o√π l'on peut mettre en ligne une image mais, malheureusement, il est impossible de bypasser les protections pour upload un fichier php...<br>
Ne serions nous pas tomb√©s dans une de ces fameuses fausses pistes dont parlait Joe au debut ? Pas si s√ªr... Regardons du c√¥t√© du code source de la page !</p>
<p><img alt="" src="https://i.postimg.cc/zvTDzhTN/Capture-d-cran-de-2020-04-22-15-51-31.png"></p>
<p>On voit donc en bas de la page, une chaine de caract√®re encod√©e en base 64</p>
<p><code>c28tZGV2LXdvcmRwcmVzcw==</code></p>
<p>On la d√©code donc avec la commande</p>
<blockquote>
<p>echo c28tZGV2LXdvcmRwcmVzcw== | base64 --decode</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/sXz8b033/Capture-d-cran-de-2020-04-22-16-01-16.png"></p>
<p>Cela ressemble √† une url de site wordpress... On nous avait dit plus haut qu'il y avait une instance wordpress vuln√©rable, ca peut √™tre int√©ressant !<br>
Allons donc √† l'adresse :</p>
<blockquote>
<p><a href="http://192.168.1.40/so-dev-wordpress">http://192.168.1.40/so-dev-wordpress</a></p>
</blockquote>
<p>Nous arrivons donc sur un site wordpress classique mais, le css ne semble pas s'√™tre charg√©...</p>
<p>En regardant dans le code source, on voit que le fichier css est cens√© √™tre √† l'url <a href="http://inplainsight/so-dev-wordpress/wp-content-themes/twentytwenty/print.css">http://inplainsight/so-dev-wordpress/wp-content-themes/twentytwenty/print.css</a></p>
<p>Il faut donc rajouter l'ip de la box au fichier hosts de notre machine. Pour en savoir plus, je vous conseille la tr√®s bonne vid√©o de Processus Thief sur le fonctionnement des virtual hosts que vous pouvez retrouver <a href="https://www.youtube.com/watch?v=uG_bRjqUzFM.">Ici</a><br>
Nous effectuons donc la commande :</p>
<blockquote>
<p>nano /etc/hosts</p>
</blockquote>
<p>On rajoute donc la ligne :</p>
<p><code>192.168.1.40 inplainsight</code></p>
<p><img alt="" src="https://i.postimg.cc/BnKCp5Bf/Capture-d-cran-de-2020-04-23-11-43-11.png"></p>
<p>Retournons donc sur le site, et voil√† ! Notre css est maintenant charg√©</p>
<p><img alt="" src="https://i.postimg.cc/G3jMZjDF/Capture-d-cran-de-2020-04-23-11-46-14.png"></p>
<p>D'apr√®s ce que l'on sait, ce wordpress est vuln√©rable, lancons donc wpscan avec rockyou comme liste de mot de passe et les utilisateurs admin, mike et joe avec la commande :</p>
<blockquote>
<p>wpscan --url <a href="http://192.168.1.40/so-dev-wordpress/">http://192.168.1.40/so-dev-wordpress/</a> --passwords /usr/share/wordlists/rockyou.txt --usernames admin,mike,joe</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/tgCh17N8/Sans-titre.png"></p>
<p>Et voila, nous avons trouv√© un couple user/pass qui est</p>
<p><code>admin/admin1</code></p>
<p>Connectons nous √† l'interface d'admin de wordpress</p>
<p><img alt="" src="https://i.postimg.cc/gJKyrRC9/Capture-d-cran-de-2020-04-23-12-09-58.png"></p>
<p>Nous avons donc acc√®s √† la page d'administration de wordpress !</p>
<p>Il est possible d'envoyer un reverse shell avec wordpress. Pour ce faire, il faut modifier une des pages du theme wordpress, pour cet exemple nous allons modifier le fichier 404.php.<br>
Pour ce faire, allons dans la rubrique Appearance puis theme editor.</p>
<p><img alt="" src="https://i.postimg.cc/qvVGGJYL/Capture-d-cran-de-2020-04-23-14-19-13.png"></p>
<p>Dans le panneau de droite, s√©lectionnez 404 Template</p>
<p><img alt="" src="https://i.postimg.cc/3JMJkGrc/Capture-d-cran-de-2020-04-23-14-23-56.png"></p>
<p>Il ne reste plus qu'√† ajouter au fichier 404.php un reverse shell en php trouv√© dans les reverse shell int√©gr√©s √† kali dans le r√©pertoire.</p>
<p><code>/usr/share/webshells/php/php-reverse-shell.php</code></p>
<p><img alt="" src="https://i.postimg.cc/zBdcM6pc/Capture-d-cran-de-2020-04-23-14-33-00.png"></p>
<p>On lance un listener netcat.<br>
On va donc ensuite sur la page 404.php que l'on vient de modifier. Voici le lien :</p>
<blockquote>
<p><a href="http://192.168.1.40/so-dev-wordpress/wp-content/themes/twentytwenty/404.php">http://192.168.1.40/so-dev-wordpress/wp-content/themes/twentytwenty/404.php</a></p>
</blockquote>
<p>On re√ßoit donc un shell dans notre terminal o√π nous avions lanc√© netcat !</p>
<p><img alt="" src="https://i.postimg.cc/k5fp2GzH/Capture-d-cran-de-2020-04-23-14-52-32.png"></p>
<h2>EXPLOITATION &amp; ELEVATION DE PRIVILEGE</h2>
<p>Apr√®s avoir spawn√© un shell tty, on regarde si il y a quelque chose dans /home, on remarque que dans /home/joe, il y a un fichier "journal" qui ne nous est pas accessible en √©criture...<br>
Dans le /home de mike, il n'y a rien. Allons donc voir du cot√© de la configuration de wordpress... Dans le dossier</p>
<blockquote>
<p>/var/www/html</p>
</blockquote>
<p>Il y a un fichier wp-config, regardons ce que contient ce fichier</p>
<p><img alt="" src="https://i.postimg.cc/X7z3JwpT/Capture-d-cran-de-2020-04-23-15-04-04.png"></p>
<p>On trouve donc des identifiants d'une base de donn√©es mysql... On essaye donc de se connecter √† la base de donn√©es avec la commande :</p>
<blockquote>
<p>mysql -u sodevwp -p</p>
</blockquote>
<p>On utilise comme mot de passe celui trouv√© dans wp-config.php, une fois connect√©, pour voir les bases de donn√©s pr√©sentes, on utilise la commande.</p>
<blockquote>
<p>show databases;</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/C5fXmLyJ/Capture-d-cran-de-2020-04-23-15-22-48.png"></p>
<p>On voit ici qu'il y a une base de donn√©es nomm√©e sodevwp, on utilise donc les commandes suivantes pour voir le contenu de la base de donn√©es sodevwp.</p>
<blockquote>
<p>use sodevwp;<br>
show tables;</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/bvPs69GF/Capture-d-cran-de-2020-04-23-15-27-14.png"></p>
<p>On regarde donc ce que contient la table sodevwp_users avec la commande :</p>
<blockquote>
<p>select * from sodevwp_users;</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/BQ1tcnZ6/Capture-d-cran-de-2020-04-23-15-32-30.png"></p>
<p>Int√©ressant ! Nous avons donc le mot de passe hash√© de l'utilisateur mike !<br>
Crackons le avec john sur notre machine en utilisant la commande :</p>
<blockquote>
<p>john --wordlist=/usr/share/wordlists/rockyou.txt mike_password.txt</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/3wRCHry2/1-3-x-J8q-Zz-Ot1vg8-FXLXTH5-A.jpg"></p>
<p>Nous avons donc le mot de passe de mike !<br>
Essayons de nous connecter √† l'utilisateur mike avec la commande :</p>
<blockquote>
<p>su mike</p>
</blockquote>
<p>Et voila ! Nous avons un shell en tant que mike ! On spawn donc un shell tty.</p>
<p><img alt="" src="https://i.postimg.cc/Z5WGHNZd/Capture-d-cran-de-2020-04-23-16-04-29.png"></p>
<p>Nous pouvons ensuite regarder le contenu de /etc et on remarque un fichier passwd-, √©trange... En regardant le contenu de ce fichier, on remarque que le mot de passe de joe est en clair dans le fichier ! Essayons donc de nous connecter au compte de joe avec la commande :</p>
<blockquote>
<p>su joe</p>
</blockquote>
<p><img alt="" src="https://i.postimg.cc/cJBBnsCb/Capture-d-cran-de-2020-04-23-16-13-56.png"></p>
<p>En utilisant SmashMouthNoThanks comme mot de passe.<br>
On cherche donc si on peut trouver quelque chose d'int√©ressant... Et dans le dossier /sbin/, il y a executable nomm√© bwrap, quand on lance l'executable, on obtient un shell en tant que root..</p>
<p><img alt="" src="https://i.postimg.cc/WbrZyf4s/Capture-d-cran-de-2020-04-23-16-38-55.png"></p>
<p>Et voil√†, cette box est termin√©e ! Merci d'avoir lu ce write-up en entier ! Si vous avez des retours, n'h√©sitez pas √† me contacter sur twitter @eban_non.</p>
<p><img alt="" src="https://i.postimg.cc/wMkQSf6f/Capture-d-cran-de-2020-04-23-16-43-21.png"></p>
  </div><!-- /.entry-content -->
  <script defer src="https://com.ramle.be/js/commento.js"></script>
  <div id="commento"></div>
</section>
</body>
</html>