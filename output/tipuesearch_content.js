var tipuesearch = {"pages":[{"title":"La puce TPM, quelle est son utilit√© ?","text":"Il y a moins d'un mois Microsoft annon√ßait officiellement Windows 11. Cette nouvelle version √† fait d√©bat, et pour cause, beaucoup (trop) d'appareils sont incompatibles avec cette version de Windows, une des raisons avanc√©es par Microsoft est le support manquant de TPM 2.0. Mais au fond, Qu'est ce que TPM et quels sont les changements apport√© par la deuxi√®me version de TPM. TPM est l'acronyme de \"Trusted Platform Module\", c'est une puce qui permet de faire des op√©rations cryptographiques, ou de garder des secrets. Cette puce est principalement faite pour g√©n√©rer des cl√©s RSA ‚Äì RSA est un algorithme de cryptographie asym√©trique ‚Äì stocker ces cl√©s et g√©rer l'acc√®s √† ces dites cl√©s. Cette puce est aussi utilis√©e pour Secure Boot . Une puce TPM poss√®de une cl√© RSA qui permet de l'authentifier, cette cl√© ne peut en th√©orie pas sortir de la puce. Un des usages principaux de TPM est de stocker diff√©rents secrets, pour par exemple chiffrer un disque avec une technologie comme BitLocker sous Windows, ou Luks sous Linux. La s√©curit√© du stockage de la cl√© pourrait poser question, comment s'assurer qu'un autre syst√®me ne puisse pas avoir acc√®s a la cl√© de d√©chiffrement ? Afin d'am√©liorer la s√©curit√© de cette puce, on peut configurer un PIN √† entrer pour acc√©der √† la cl√© de d√©chiffrement. Si la cl√© n'est pas prot√©g√©e par un PIN, la puce laissera quand m√™me l'acc√®s uniquement au syst√®me qui a cr√©e la cl√©, m√™me si dans certains cas particulier la v√©rification ne se fait pas correctement. Comme faille de s√©curit√© dans TPM on peut notamment citer TPM-FAIL qui permet simplement d'extraire la cl√© priv√©e. Un autre probl√®me de s√©curit√© que pr√©sente TPM est qu'avec un acc√®s physique il est possible d'espionner ce que la puce fait et donc d'en extraire des donn√©es confidentielles, si vous souhaitez en savoir plus, la page Wikipedia sur TPM cite d'autres failles de s√©curit√© : https://en.wikipedia.org/wiki/Trusted_Platform_Module#Attacks . Un autre probl√®me de TPM qui est tr√®s r√©pandu c'est le vecteur d'attaque physique, en observant directement sur les bus de la puce avec du mat√©riel sp√©cifique il est possible d'extraire les cl√©s de la puce, ce type d'attaque se nomme cold boot atttack . La puce TPM est divis√©e en plusieurs partie qu'on nomme des Platform configuration Registers qui ont plusieurs utilit√©, comme le stockage de cl√©, firmware etc. TPM a connu des √©volutions, je vais me concentrer ici seulement sur la version 1.2 et 2 de TPM. Une des avanc√©es majeure est l'impl√©mentation des courbes elliptiques sur la version 2, les algorithmes de chiffrement √† courbe elliptique sont des algorithmes de cryptographie asym√©trique, concurrents √† RSA notamment, qui au lieu d'utiliser les nombres premiers utilisent des courbes elliptiques, l'avantage compar√© √† RSA c'est leur r√©sistance suppos√©e aux ordinateurs quantiques. Une autre avanc√©e est le support de SHA256 qui est bien plus r√©sistant que SHA1 √† diff√©rent type d'attaque. √Ä mon avis, le fait pour Windows 11 de forcer TPM est relativement inutile, en effet BitLocker n'est pas activ√© par d√©faut, et Secure Boot ne d√©pends pas forc√©ment de TPM. Le mieux serait de recommander sans pour autant forcer. TPM reste tr√®s int√©ressant pour √©viter de taper un mot de passe au boot, qui en plus de prendre du temps peut √™tre vu par un attaquant, et permettre de v√©rifier l'int√©grit√© du d√©marrage en s√©parant la gestion des cl√©s du bios (l'avantage est que pour changer le jeu de cl√©s publiques il faut effacer la cl√© de d√©chiffrement). Un des soucis les plus important de TPM reste que la plupart des impl√©mentations ne sont pas libres, une backdoor pourrait donc y √™tre ins√©r√© par le constructeur. Une alternative √† TPM peut √™tre des puces plus sp√©cifique comme la puce titan de google, ou T2, mais ces deux puces restent malheureusement propri√©taires.","tags":"misc","url":"https://ilearned.eu.org/tpm.html","loc":"https://ilearned.eu.org/tpm.html"},{"title":"Comment faire une autorit√© de certification (CA) SSH ?","text":"SSH est un protocole tr√®s r√©pandu sur internet, il est utilis√© par des millions d'entreprises et particuliers chaque jour, mais bien souvent de fa√ßon peu s√©curis√©e. Vous connaissez peut-√™tre les cl√©s SSH qui permettent une meilleure s√©curit√© que les mots de passe, mais ces cl√©s posent un probl√®me, et notamment en entreprise, imaginez une entreprise avec 500 ing√©nieurs, il faudrait, sur chaque serveur SSH, mettre les 500 cl√©s publiques des 500 ing√©nieurs ! Pour rem√©dier √† cela il existe une solution que nous allons √©tudier dans cet article, les autorit√©s de certification SSH. La th√©orie Le syst√®me de certificats de SSH est relativement similaire √† celui de TLS (x509), une premi√®re paire de cl√©s publiques/priv√©es est g√©n√©r√©e, elle servira d' autorit√© de certification , le cl√© priv√©e de cette autorit√© de certification doit bien √©videmment rester ultra confidentielle. On va ensuite g√©n√©rer une autre paire de cl√© sur chaque client. On pourra ensuite, avec la cl√© priv√©e de notre autorit√© de certification, signer la publique des clients afin de g√©n√©rer un certificat. Ainsi, n'importe quel certificat sign√© par notre autorit√© de certification peut √™tre consid√©r√©e comme \"de confiance\". Signer les cl√©s h√¥te Lors de la premi√®re connexion √† un serveur SSH, le serveur envoie sa cl√© publique (appel√©e cl√© h√¥te) au client et le client doit approuver, ou non, l'authenticit√© de la cl√© envoy√©e par le serveur, c'est le fameux message The authenticity of host 'XXXXX' can ' t be established. ED25519 key fingerprint is SHA256:JxfJl38mBVY2jX0h/LWDuB1OtgYfgLBr3nJw/lw5GFE. This key is not known by any other names Are you sure you want to continue connecting ( yes/no/ [ fingerprint ]) ? Nous avons tous pour (mauvaise) habitude de simplement entrer yes sans se poser plus de questions, mais cette habitude est tr√®s dangereuse, un attaquant pourrait usurper le serveur SSH auquel nous essayons de nous connecter ! Pour rem√©dier √† cela il existe plusieurs solutions comme SSHFP (qui est relativement similaire √† TLSA , mais avec SSH) ou les autorit√©s de certification (CA) c'est ce que nous allons d√©tailler ici. La premi√®re √©tape est donc de cr√©er une paire de cl√©s pour notre autorit√© de certification avec la commande ssh - keygen - a 1000 - t ed25519 - f / etc / ssh / ca / id_ed25519 - C \"contact+ca@eban.bzh\" L'option -a indique le nombre de tours KDF (fonction de d√©rivation de la cl√©), plus ce nombre est √©lev√©, plus la v√©rification du mot de passe sera lente, mais plus la cl√© sera r√©sistante au bruteforce. -t indique l'algorithme √† utiliser pour la cl√©, ici c'est ed25519, l'algorithme de chiffrement le plus s√©curis√© √† ce jour support√© par SSH. Une fois cette premi√®re paire de cl√© cr√©√©e, nous allons pouvoir l'utiliser pour signer les cl√©s h√¥tes publiques de nos serveurs SSH, la premi√®re √©tape est donc d'aller cherche ces cl√©s h√¥tes, elles sont, sur chaque serveur SSH, dans le r√©pertoire /etc/ssh, ici je ne g√©n√®rerait qu'un certificat en ed25519 mais la m√™me d√©marche est possible avec n'importe quel algorithme support√© par OpenSSH. La cl√© publique h√¥te est donc disponible sous le chemin /etc/ssh/ssh_host_ed25519_key.pub copions-l√† dans le r√©pertoire /etc/ssh/ca de la machine sur laquelle nous avons g√©n√©r√© l'autorit√© de certification. On peut ensuite lancer la commande ssh-keygen -h -s /etc/ssh/ca/id_ed25519 -n pi01,pi01.infra.eban.bzh -I pi01 -V +3650d ssh_host_ed25519_key.pub L'option -n correspond aux principals , dans le cas d'une cl√© h√¥te, elle doit correspondre aux diff√©rents noms de domaine auxquelles la cl√© pourrait √™tre associ√©e. -I correspond √† l' ID , un identifiant unique attribu√© √† la cl√©, c'est simplement son \"nom\". Une fois la cl√© publique sign√©e, il ne nous reste plus qu'√† copier le certificat qui aura √©t√© g√©n√©r√© dans le r√©pertoire /etc/ssh/ca/ssh_host_ed25519_key-cert.pub sur le serveur SSH (ici nous le mettrons √† l'emplacement /etc/ssh/ssh_host_ed25519_key-cert.pub ) et √† ajouter la ligne suivante √† la fin du fichier /etc/sshd_config . HostCertificate /etc/ssh/ssh_host_ed25519_key-cert.pub On red√©marre ensuite le d√©mon ssh avec la commande systemctl restart sshd . Derni√®re √©tape, on va indiquer √† tous les clients SSH de faire confiance aux certificats h√¥tes sign√©s par notre autorit√© de certification en utilisant la commande echo \"@cert-authority * $( cat /etc/ssh/ca/id_ed25519.pub ) \" >> ~/.ssh/known_hosts Et voil√† ! Notre autorit√© de certification est maintenant configur√©e sur le serveur SSH. Signer les cl√©s clients La proc√©dure pour signer les cl√©s des clients est relativement similaire, apr√®s avoir g√©n√©r√© une paire de cl√©s pour l'autorit√© de certification (on gardera la m√™me que celle g√©n√©r√©e dans la partie pr√©c√©dente), on lance la commande ssh - keygen - s / etc / ssh / ca / id_ed25519 - n pi - I pc01 @eban . bzh - V + 30 d - z 1 / home / USERNAME / . ssh / id_ed25519 . pub N'oubliez pas de changer USERNAME par votre nom d'utilisateur. Si vous obtenez une erreur, c'est probablement que n'avez pas d√©j√† une paire de cl√© SSH en ed25519 vous pouvez en g√©n√©rer une avec la commande ssh-keygen -t ed25519 Une fois la paire de cl√© g√©n√©r√©e, vous pouvez relancer la premi√®re commande. Ici l'option -n correspond au‚ãÖx nom ‚ãÖs d'utilisateur distant (= sur le serveur SSH) pour lesquels vous souhaitez autoriser que cette cl√© soit valide, cette cl√© ne sera donc valide que pour le nom d'utilisateur distant pi . -z correspond au serial de ce certificat, c'est un nombre que vous devrez incr√©menter si vous r√©g√©n√©rez la cl√© apr√®s la dur√©e d'expiration (ici mise √† 30 jours). Une fois cela fait, il ne nous reste plus qu'√† copier la cl√© publique de notre autorit√© de certification (contenue dans /etc/ssh/ca/id_ed25519.pub ) sur notre serveur SSH, ici nous la mettrons dans le fichier /etc/ssh/ca.pub et √† ajouter la ligne TrustedUserCAKeys /etc/ssh/ca.pub √† la fin du fichier /etc/ssh/sshd_config . On termine par red√©marrer le service SSH, sudo systemctl restart sshd . Nous avons maintenant mit en place notre autorit√© de certification ! On peut simplement la tester en se connectant via SSH au serveur, vous ne devriez pouvoir vous connecter sans mot de passe et n'avoir aucune demande de validation de la cl√© publique de la machine h√¥te. J'esp√®re que cet article vous aura √©t√© utile, si vous avez des questions n'h√©sitez pas √† nous les poser en commentaire ou sur Twitter .","tags":"misc","url":"https://ilearned.eu.org/ca-ssh.html","loc":"https://ilearned.eu.org/ca-ssh.html"},{"title":"S√©curiser votre syst√®me d'exploitation gr√¢ce aux MAC","text":"Un reproche souvent fait √† Linux est sa gestion des droits souvent trop permissive. Il y a bien s√ªr une raison historique, √† la naissance des diff√©rents syst√®mes d'exploitation que l'on connait aujourd'hui la s√©curit√© n'√©tait pas la pr√©occupation principale. Le but de base n'√©tait pas non plus de compliquer la t√¢che des utilisateurs (la s√©curit√© se fait toujours au prix de complexit√© suppl√©mentaire). Le probl√®me de cette philosophie de d√©part est qu'il faut repenser la s√©curit√© avec une base trop ouverte. Sous Linux tout est fichier, les p√©riph√©riques physiques ont par exemple, un fichier attribu√© dans /dev . La s√©curit√© d'acc√®s pour les fichiers se base sur les permission de chaque fichier. Ce m√©canisme montre vite des limites. Les autorisations sont tr√®s limit√©es, sous Linux ces autorisations sont divis√©es en 3, ce que l'utilisateur propri√©taire peut faire, ce que le groupe propri√©taire peut faire et ce que tout le monde est autoris√© √† faire. Chaque partie peut avoir 3 droits diff√©rents : R (read) : Lecture W (write) : √âcriture X (Execute) : Ex√©cution (dans le cadre d'un dossier c'est l'autorisation pour lister le contenu) On peut visualiser les permissions via la commande ls -l <dossier> : % ls -l total 0 - rwxr - xr - x 1 ramle ramle 0 Jul 19 17 : 05 executable - rw ------- 1 root root 0 Jul 19 17 : 05 root_only ls divise en 3 parties les permissions, celle de l'utilisateur, du groupe et de tout le monde : Le soucis de se baser uniquement sur les permissions des fichiers est le manque de contr√¥le, le sch√©ma de s√©curit√© des MAC permet de renforcer le tout en regardant beaucoup plus de facteur. Le concept est de regarder toutes le actions faites sur la machine, et de regarder l'action et l'autoriser ou non en fonction des r√®gles d'acc√®s. L'avantage de ce mod√®le par rapport √† la s√©curit√© historique de Linux (et UNIX par la m√™me occasion) est d'√™tre bien plus pr√©cis, par exemple autoriser √† une application seulement certains ports et fichiers (fichier qui pourrait selon le syst√®me de fichier lui √™tre autoris√©). Sous Linux, il n'y a pas de base de framework de MAC, mais des modules dans le noyaux sont pr√©vu pour qu'on y greffe un framework il y en a deux importants, Apparmor et SELinux. Les deux ont des fonctionnalit√©s similaires, mais se diff√©rencient par un point important, Apparmor se base sur le chemin complet d'un fichier, l√† ou SELinux se base seulement sur le nom, cette diff√©rence est assez minime dans la plupart des cas, mais en fonction du framework utilis√©, des m√©thodes de contournement se basant sur ces sp√©cificit√©s, par exemple en utilisant des liens virtuelles (symlink) ou renommant un fichier, une bonne politique d'acc√®s √©vite cependant les contournements. Bien s√ªr, Linux n'est pas le seul syst√®me d'exploitation qui utilise des contr√¥les d'acc√®s plus pouss√© qu'uniquement des permissions basiques, Windows fonctionne sur ce principe aussi tout comme MacOS et BSD avec l'int√©gration de TrustedBSD.","tags":"misc","url":"https://ilearned.eu.org/mac.html","loc":"https://ilearned.eu.org/mac.html"},{"title":"MQTT, comprendre le standard de la domotique","text":"Si vous vous √™tes d√©j√† int√©ress√©‚ãÖe √† la domotique, vous avez s√ªrement entendu parler du protocole MQTT (Message Queuing Telemetry Transport), MQTT est un protocole tr√®s utilis√© pour faire de l'automatisation notamment, nous allons entrer plus en profondeur dans le fonctionnement d'MQTT dans cet article √† travers l'exemple d'une lampe connect√©e. MQTT fonctionne sur le principe de Topics dans lesquels les diff√©rents appareils peuvent publier ou recevoir des messages. La fonctionnement de ce protocole est relativement simple, le client commence par s'authentifier aupr√®s du serveur, puis il peut recevoir et/ou envoyer des messages au serveur, appel√© Broker , voici un exemple de trame r√©seau. On peut donc voir que ce protocole est tr√®s simple de fonctionnement, et ce n'est pas un hasard qu'il soit tr√®s utilis√© en domotique, bien souvent les appareils en domotique sont tout petits et n'ont pas la capacit√© d'impl√©menter des protocoles tr√®s lourd. Vous pouvez voir ci-dessus un exemple tr√®s simple d'utilisation du protocole MQTT, un t√©l√©phone publie un message au broker MQTT sur le topic stat/phone quand le r√©veil sonne, une lampe connect√©e est abonn√©e au topic stat/phone , quand un message indiquant qu'une alarme vient de sonner lui parvient, elle s'allume et indique par un message sur le topic stat/lampe/POWER qu'elle est allum√©e. Ce sc√©nario est tr√®s simple mais il montre √† quel point MQTT est modulable et peut permettre une automatisation pouss√©e. Si vous √™tes int√©ress√©‚ãÖe par la domotique, sachez qu'il existe des petits modules appel√©s modules Sonoff qui permettent de rendre \"connect√©\" n'importe quel appareil √©lectrique (une lampe de chevet par exemple) et qui, une fois un firmware (syst√®me d'exploitation) sp√©cial appel√© Tasmota flash√© permettent aussi de publier des messages sur un broker MQTT. Si vous n'√™tes pas un aficionado de la ligne de commande, il existe des logiciels comme Node-RED ou Automate sur Android qui permettent de s'essayer √† la domotique et l'automatisation facilement.","tags":"misc","url":"https://ilearned.eu.org/mqtt.html","loc":"https://ilearned.eu.org/mqtt.html"},{"title":"V√©rifier l'int√©grit√© d'un syst√®me d'exploitation gr√¢ce √† Secure Boot.","text":"La s√©curit√© d'un syst√®me d√©pends de beaucoup de facteur, un des facteurs important est de pouvoir v√©rifier l'int√©grit√© du syst√®me d√©marr√©, en effet sans cette v√©rification un attaquant pourrait sans trop de difficult√©s modifier les fichiers de d√©marrage pour ajouter un malware. Cet article se concentrera sur les machines de bureaux. Pour bien comprendre comment peuvent √™tre effectu√©es des attaques pendant le boot il est important de comprendre le fonctionnement du d√©marrage en mode BIOS, et son rempla√ßant l'UEFI. BIOS Le d√©marrage en BIOS s'appuie sur une table des partitions en MBR (master boot record), pour d√©marrer le bios va ex√©cuter du code contenu dans la table des partitions, ce code s'occupe de passer la main au bootloader qui va s'occuper de lancer le syst√®me. Un probl√®me assez flagrant apparait d√©j√†, du code peut √™tre directement ins√©r√© dans cette partie, aucune v√©rification n'est effectu√©e par le BIOS. Un attaquant pourrait aussi attaquer le bootloader qui ne peut pas √™tre chiffr√©. Sous Linux (nous verrons le fonctionnement de Windows un peu plus loin) le bootloader le plus courant est grub, il ins√®re dans le MBR de quoi charger son code complet qui est contenu dans /boot , la plupart des bootloader sous linux fonctionnent sur le m√™me principe. Pour √©viter une modification du syst√®me on pourrait chiffrer le partition root (aussi appel√© Userland) et faire un /boot √† part (le bootloader ne peut pas √™tre chiffr√©), un probl√®me se pose alors, l'initramfs et le kernel sont toujours en clair. Grub (et c'est √† ma connaissance le seul) permet de d√©chiffrer le partition boot, pour garder l'initramfs et le kernel chiffr√©. Mais grub en lui m√™me est toujours modifiable, m√™me chose pour le code ex√©cut√© directement dans le MBR. En plus de ne pas √™tre totalement s√©curis√©, avec cette m√©thodes la phrase de passe doit √™tre tap√©e deux fois, une fois pour lire l'initramfs et une autre fois pour d√©chiffrer la partition root. (grub ne la retient pas). Une solution possible serait de signer les diff√©rents √©l√©ment du boot, le probl√®me est qu'en BIOS aucun m√©canisme pour la v√©rification de signature existe. Avec un BIOS nous n'avons pas de possibilit√© de s√©curiser enti√®rement un syst√®me Linux. Pour Windows, le concept est tr√®s proche, le BIOS va ex√©cuter le code dans le MBR, ce code va enclencher le bootloader de Windows qui, depuis Windows Vista, est bootmgr, chiffrer son disque pose le m√™me soucis que sous Linux, le bootloader restera en clair. UEFI Avec UEFI on se passe de MBR au profit de GPT qui apporte un certain nombre d'avantages. Le processus de boot ne se passe plus par un code ex√©cutable dans la partie MBR, ce code est contenu dans une partition en FAT32 (ou FAT16), ce qui permet de ne plus √™tre aussi limit√© en taille, la partie d√©di√© au code de d√©marrage dans MBR n'est que de 446 bytes. UEFI apporte aussi une √©volution majeure pour la s√©curit√© : Secure Boot, c'est un moyen de v√©rifier l'int√©grit√© via une signature du fichier EFI. Un fichier EFI est un ex√©cutable lanc√© par l'UEFI, on pourrait le comparer aux ELF de Linux, ou aux exe de Windows. Lorsque qu'un pc avec Secure Boot d√©marre, il v√©rifie le binaire EFI, pour voir si la signature corresponds √† une cl√© de \"confiance\" et si la signature n'est pas dans dans la liste des cl√©s √† refuser. L'UEFI se base sur des variables pour les cl√©s, vous pouvez les voir depuis Linux via l'utilitaire \"efi-readvars\", ce qui sur ma machine donne : Variable PK, length 823 PK: List 0, type X509 Signature 0, size 795, owner 5b2a4205-8ee1-404d-a357-45629f968019 Subject: CN=Ramle PK Issuer: CN=Ramle PK Variable KEK, length 825 KEK: List 0, type X509 Signature 0, size 797, owner 5b2a4205-8ee1-404d-a357-45629f968019 Subject: CN=Ramle KEK Issuer: CN=Ramle KEK Variable db, length 823 db: List 0, type X509 Signature 0, size 795, owner 5b2a4205-8ee1-404d-a357-45629f968019 Subject: CN=Ramle DB Issuer: CN=Ramle DB Variable dbx has no entries Variable MokList has no entries Regardons de plus pr√®s chaque variable : PK : C'est la cl√© la plus haute dans la chaine de confiance, elle est l√† pour signer la cl√© KEK, une seule cl√© est possible dans cette variable. En g√©n√©ral c'est le constructeur qui met sa cl√©, si vous voulez contr√¥ler totalement la chaine de confiance il faudra donc la changer. KEK : Ces cl√© sont utilis√©es pour signer les cl√©s qui iront dans DB ou DBX, souvent de base il y a 2 KEK, une pour Microsoft et une autre pour le Fabricant. DB : Ce sont les cl√©s utilis√©es pour la v√©rifications des binaires EFI, souvent l'ordinateur vient avec les cl√©s du constructeur, de Microsoft, Canonical (entreprise qui est derri√®re Ubuntu) et parfois d'autres entreprises. DBX : C'est la liste des cl√©s qui ne sont plus de confiance. MOKList : C'est utilis√© par un outil du nom de Shim, cet outil est l√† pour charger un autre bootloader qui ne serait pas sign√© avec les cl√©s pr√©sentent dans DB, Shim va v√©rifier le bootloader via les cl√©s dans la MOKList qui est g√©r√© par l'utilisateur, et non via l'UEFI directement. Ces variables sont bien sur modifiable sur la plupart des pc, ce qui permet de g√©rer sa propre PKI (public key infrastructure). Si on veut un r√©el contr√¥le il faut g√©rer soit m√™me ses cl√©s, sous Linux c'est possible sans trop de difficult√©s, FreeBSD et OpenBSD semblent supporter aussi (je n'ai pas eu l'occasion de tester) et sous Windows on peut soit utiliser les cl√©s de Microsoft ou utiliser ses propres cl√©s ce qui semble en th√©orie possible. J'esp√®re que cette article vous aura plus, je pense prochainement faire un petit guide pour la gestion de Secure Boot sous Linux, je vous laisse donc surveiller les sorties üëÄ. On se retrouve apr√®s demain pour un article sur MQTT","tags":"misc","url":"https://ilearned.eu.org/secure_boot.html","loc":"https://ilearned.eu.org/secure_boot.html"},{"title":"Les version oubli√©es du protocole IP üîé","text":"On connait tous IPv4 et IPv6 qui sont deux protocoles largement r√©pandus (bien qu'un des deux ne le soit pas assez &#94;&#94;), mais on pourrait l√©gitimement se demander s'il existe d'autres version du Protocole Internet, nous ferrons donc dans cet article un petit tour d'horizon des diff√©rentes it√©rations du protocole IP et de leurs sp√©cificit√©s. IPv1 2 et 3 ‚àí La gen√®se du protocole Internet Le premier document d√©crivant le fonctionnement d'IP est la RFC 675 publi√©e en 1974 mais pr√©sent√©e d√®s 1973 √† l'International Network Working Group. Si vous parcourez cette RFC vous remarquerez qu'elle ne fait pas mention du protocole IP, mais de TCP, en effet √† l'√©poque, TCP et IP n'√©taient pas s√©par√©s et le principe de couches apport√© notamment par le mod√®le TCP/IP, sortit en 1976, n'√©tait pas encore d'actualit√©. Parler d'IPv1 est donc un abus de langage, le terme adapt√© serait plut√¥t TCP version 1. Ce protocole avait une particularit√© int√©ressante, il contenait quatre champs adresse dans son header, contre deux pour IPv6. Un pour le r√©seau de destination (et d'origine), rappelez vous, nous sommes en 1974 et √† cette √©poque le r√©seau Internet comme nous le connaissons aujourd'hui n'existe pas, il existe donc diff√©rents r√©seaux concurrent, ce champ dans l'en-t√™te a pour but de sp√©cifier sur quel r√©seau le paquet doit transiter. Ainsi, vous pouvez voir ci-dessous les diff√©rentes valeurs possibles pour ce champ et donc les principaux r√©seaux qui cohabitent √† cette √©poque. 1010 = ARPANET 1011 = UCL 1100 = CYCLADES 1101 = NPL 1110 = CADC 1111 = EPSS Les troisi√®me et quatri√®me champs sont destin√©s √† accueillir les adresses TCP d'origine et de destination, ces adresses ne sont pas tr√®s d√©taill√©es dans la RFC, mais on sait qu'elles sont d'une longueur de 16 bits (65 536 adresses diff√©rentes), elles correspondent peu ou prou √† ce qu'on appelle aujourd'hui \"adresses IP\". Cette premi√®re version de TCP est vraiment exp√©rimentale, elle n'a pas √©t√© d√©ploy√©e √† grande √©chelle comme l'ont √©t√© IPv4 et IPv6 Vient ensuite en 1977 la deuxi√®me version de TCP (et donc par extension du protocole internet), cette version, publi√©e dans l' IEN 5 , apporte certaines am√©liorations dont notamment le passage √† un \"Network Identifier\", ce qui √©tait auparavant appel√© r√©seau de destination/origine, cod√© sur 8 bits. Autre diff√©rence, les \"host identifier\", anciennement appel√©s adresses TCP , sont maintenant cod√©s sur 24 bits, soit un total de 16 777 216 adresses. On peut aussi voir le d√©but de la s√©paration entre TCP et IP dans ce sch√©ma d'√©poque avec les parties \"TCP Header\" et \"Internet Header\". S√©paration qui sera act√©e dans la version 3 de TCP, publi√©e en 1978, ce qui repr√©sente une avanc√©e majeure dans l'√©volution du protocole internet. IPv5 IPv5 n'a pas r√©ellement exist√©, il s'agit en fait du Stream Protocol , abr√©g√© ST-II, un protocole de couche 3 (comme IP), cr√©√© pour faciliter l'envoi de vid√©o et d'audio par internet et qui avait dans le champ version la valeur 5. C'√©tait donc une version modifi√©e d'IPv4 mais qui avait des adresses cod√©es sur 32 bits, comme pour IPv4, qui ne r√©pondait donc pas √† la probl√©matique principale pos√©e par IPv4, le manque d'adresses. Ce protocole marque le d√©but de VoIP (Voice over IP) mais il ne sera pas d√©ploy√© √† grande √©chelle, VoIP sera ensuite simplement d√©ploy√© sur IPv4. IPv7, 8 et 9 ‚àí Le futur ? Ou pas‚Ä¶ IPv7 est un protocole appel√© TP/IX sortit en 1993, les adresses IP sont cod√©es sur 64 bits (contre 128 avec IPv6), on ne d√©taillera pas plus ce protocole mais si vous souhaitez en savoir plus je vous invite √† lire la RFC d'IPv7 qui est tr√®s compr√©hensible. IPv8 (mon petit pr√©f√©r√© &#94;&#94;) appel√© PIP et sortit en 1994 son fonctionnement repose en partie sur le syst√®me de DNS , chaque utilisateur du r√©seau a un PIP ID , un identifiant unique cod√© sur 64 bits, ainsi, peu importe d'o√π il se connecte sur le r√©seau, il est possible de l'identifier rien qu'avec son ID. PIP a donc √©t√© avant tout pens√© pour faciliter les √©changes entre appareils changeant d'adresse IP. On pourrait par exemple imaginer une connexion SSH utilisant uniquement le PIP ID pour s'authentifier et qui, m√™me si un des deux composants de la connexion (le client ou le serveur) change d'adresse IP reste stable. Je parlais plus t√¥t du DNS, en effet, avec PIP le DNS est modifi√© pour renvoyer √† la fois l(es) adresse(s) IP mais aussi le PIP ID . Ce syst√®me a n√©anmoins un probl√®me majeur, le PIP ID permettrait de pister tr√®s facilement les utilisateurs. IPv9 enfin est un protocole tr√®s peu d√©taill√©, il avait √©t√© annonc√© en grande pompe par le gouvernement chinois, celui-ci se targuant du fait que cette version d'IP ait √©t√© adopt√©e dans les secteurs militaires et civils, mais depuis cet effet d'annonce aucune sp√©cification technique n'a √©t√© publi√©e, seulement des bruits de couloir comme quoi les adresses seraient cod√©es sur 256 bits et compos√©es uniquement de caract√®res num√©riques (et non pas hexad√©cimaux comme c'est le cas d'IPv6).","tags":"misc","url":"https://ilearned.eu.org/versions-ip.html","loc":"https://ilearned.eu.org/versions-ip.html"},{"title":"Mod√®le de s√©curit√© Windows","text":"Introduction \"Acc√®s refus√©\". S'il y a bien une erreur frustrante, c'est s√ªrement celle-ci. Sur Windows nous y sommes pourtant souvent confront√©s, surtout dans une perspective attaquante. En revanche, peu de gens comprennent pourquoi cette erreur (ou d'autres) vient s'immiscer dans sa confortable utilisation de son syst√®me d'exploitation. Dans cet article, je t√¢cherais de vous pr√©senter, dans les grandes lignes, le mod√®le de s√©curit√© qu'utilise Windows, principalement les notions de privil√®ge d'acc√®s et de contr√¥le d'acc√®s. De mani√®re g√©n√©rale, lorsque je parlerais d'objet Windows, je parlerais d'utilisateurs, de machines, de fichiers, ou encore de processus. Contexte de s√©curit√© Pour bien comprendre la suite, il est n√©cessaire de comprendre ce qu'est un contexte de s√©curit√© chez notre ami Windows. Ce dernier d√©signe un ensemble d'attributs ou de r√®gles de s√©curit√© actuellement en vigueur pour reprendre la d√©finition de Microsoft. Un contexte de s√©curit√© se traduira par une structure de donn√©es particuli√®res d√©finis par la SSPI (\"Security Support Provider Interface\"), une API Windows √©crite dans le but d'interagir avec le contexte de s√©curit√©, elle est notamment utilis√©e, par exemple, pour l'authentification. Autrement dit, le contexte de s√©curit√© d√©finit les √©l√©ments de bases du syst√®me de s√©curit√© de notre os favori (si c'est pas le cas faites comme si). SecurableObject Un objet est dit \"s√©curisable\" s'il a la capacit√© de poss√©der un descripteur de s√©curit√©. De mani√®res g√©n√©rales, √©norm√©ment d'objet dans Windows sont des SecurableObject . Les processus, les cl√©s de registre, les fichiers/r√©pertoires, les objets ‚ÄòActive Directory' et bien d'autres. Ils forment donc le c≈ìur des interactions entre nous et le syst√®me d'exploitation. J'ai parl√© des descripteurs de s√©curit√©, ces derniers sont simplement des listes de plusieurs caract√©ristiques. Ils contiennent le SID (\"Security Identifier\", qui est un identifiant unique) du propri√©taire de l'objet, le SID du groupe propri√©taire, et des ACLs pour \"Access Control Lists\". Les descripteurs de s√©curit√© sont usuellement au format SDDL (\"Security Descriptor Definition Langage\") bien que peu reluisant, il est en r√©alit√© tr√®s pratique car simple d'utilisation (non pas de compr√©hension). Token d'acc√®s Lorsqu'un utilisateur Windows se connecte √† son compte local (ou Active Directory) plusieurs informations seront alors stock√©s dans la m√©moire. De mani√®re assez √©vidente, il contiendra le condensat du mot de passe (sauf configurations tr√®s improbable ou un syst√®me relativement vieux et dans ces cas pr√©cis, ce sera le mot de passe en claire), son SID , le SID de son groupe, des privil√®ges d'acc√®s (nous y reviendrons plus tard) et bien d'autres informations. On regroupe tout cela dans ce que l'on appelle un token d'acc√®s. Ce dernier est alors gard√© dans un processus un peu particulier appel√© LSASS.exe pour \"Local Security Autority SubSystem Service\". Ce dernier est donc vital et tr√®s sensible. Lorsqu'on interagit avec le syst√®me d'une quelconque mani√®re, une copie de notre token d'acc√®s est alors utilis√©e. Dans le cas d'un fichier, les informations que le token d'acc√®s contient vont donc √™tre compar√©es avec les informations contenues dans la DACL (qui est une liste contenant les acc√®s, plus d'information sur ce sujet un peu apr√®s) garantissant ou non un acc√®s d'une certaine valeur. Il peut √™tre destin√© √† de l'√©criture, de la lecture ou bien m√™me pour de l'ex√©cution. Un cas plus int√©ressant est celui du d√©marrage d'un programme. En effet, ce dernier est lanc√© en tant qu'un utilisateur en particulier, il ne doit donc pas contourner ce fameux syst√®me d'acc√®s. C'est pourquoi les processus sont consid√©r√©s comme des SecurableObject , et dans cette situation, une copie de notre token d'acc√®s est √©galement donn√© et quand le programme interagira avec le syst√®me, il le fera bien selon les droits et l'identit√© de l'utilisateur connect√©. La fonction CreateProcessA() est une fonction de l' API Windows kernel32.dll qui permet de cr√©er un nouveau processus. Privil√®ges d'acc√®s Comme mentionn√© plus t√¥t, le token d'acc√®s renferme en son sein un certain nombre de privil√®ges. Ces derniers sont attribu√©s √† chaque connexion, en fonction des r√®gles de s√©curit√©. Plus pr√©cis√©ment, les privil√®ges d'acc√®s sont donn√©s en fonction du groupe d'appartenance auquel on attribut des droits par d√©faut gr√¢ce aux GPOs locales (dans gpedit.msc , Configuration Ordinateur \\ Param√®tres windows\\ Param√®tres de s√©curit√©\\ Strat√©gies local\\ Attribution des droits utilisateur ). La liste de ces privil√®ges n'est pas pr√©sente sous forme d'√©num√©ration classique, en revanche voici une impl√©mentation en PowerShell pour bien se rendre compte de l'ensemble de ces privil√®ges (issus de PSReflect-Functions ). $SecurityEntity = psenum $ENUM SecurityEntity UInt32 @{ SeCreateTokenPrivilege = 1 SeAssignPrimaryTokenPrivilege = 2 SeLockMemoryPrivilege = 3 SeIncreaseQuotaPrivilege = 4 SeUnsolicitedInputPrivilege = 5 SeMachineAccountPrivilege = 6 SeTcbPrivilege = 7 SeSecurityPrivilege = 8 SeTakeOwnershipPrivilege = 9 SeLoadDriverPrivilege = 10 SeSystemProfilePrivilege = 11 SeSystemtimePrivilege = 12 SeProfileSingleProcessPrivilege = 13 SeIncreaseBasePriorityPrivilege = 14 SeCreatePagefilePrivilege = 15 SeCreatePermanentPrivilege = 16 SeBackupPrivilege = 17 SeRestorePrivilege = 18 SeShutdownPrivilege = 19 SeDebugPrivilege = 20 SeAuditPrivilege = 21 SeSystemEnvironmentPrivilege = 22 SeChangeNotifyPrivilege = 23 SeRemoteShutdownPrivilege = 24 SeUndockPrivilege = 25 SeSyncAgentPrivilege = 26 SeEnableDelegationPrivilege = 27 SeManageVolumePrivilege = 28 SeImpersonatePrivilege = 29 SeCreateGlobalPrivilege = 30 SeTrustedCredManAccessPrivilege = 31 SeRelabelPrivilege = 32 SeIncreaseWorkingSetPrivilege = 33 SeTimeZonePrivilege = 34 SeCreateSymbolicLinkPrivilege = 35 } Et oui, 35 privil√®ges √ßa fait beaucoup. Mais √† quoi servent-ils ? Ils permettent d'effectuer certaines t√¢ches syst√®mes. Il ne faut donc pas les confondre avec les ACE (\"Access Control Entry\", qui repr√©sente un droit attribuer dans une DACL ), car ces derni√®res d√©finissent l'acc√®s √† un SecurableObject . Par exemple, le droit SeBackupPrivilege est donn√© √† tout membre du groupe Backup Operators et permet de lire le contenu d'un fichier peu importe ses ACLs (sauf si une interdiction explicite √† votre encontre est pr√©sente). Le droit SeRestorePrivilege permet identiquement d'√©crire un fichier. Le droit SeDebugPrivilege (r√©serv√© aux Administrateurs), permet d'acc√©der et de manipuler la m√©moire d'un autre programme, un programme que nous n'avons pas lanc√©. C'est typiquement ce droit que demande Mimikatz pour acc√©der aux fameux condensats de mots de passe gard√© par LSASS.exe . Vous pouvez trouver une liste compl√®te des droits donn√©s par quel privil√®ge dans la documentation officielle de Microsoft . Ces privil√®ges, sont donc naturellement tr√®s puissant et il ne faut surtout pas n√©gliger leur s√©curit√©, qui poss√®de quoi. Bon, mais comment puis-je clairement savoir de quels privil√®ges je dispose ? La commande la plus simple pour cela est whoami /all . whoami.exe ouvre le token d'acc√®s de son propre processus, or comme nous l'avons dit plus t√¥t, ce dernier contient toutes les informations dont le syst√®me √† besoin pour achever ses t√¢ches, notamment acc√©der aux SecurableObject . Ainsi, nous pouvons voir nos privil√®ges ( whoami /priv ), nos groupes ( whoami /groups ), notre SID ( whoami /user ) et bien d'autres. Un petit exemple, une fois connect√©, je lance une invite de commande PowerShell et tape whoami /priv . Par malchance, le droit semble alors d√©sactiv√©. Windows PowerShell Copyright (C) Microsoft Corporation. Tous droits r√©serv√©s. Testez le nouveau syst√®me multiplateforme PowerShell https://aka.ms/pscore6 PS D:\\> whoami /priv Informations de privil√®ges ---------------------- Nom de privil√®ge Description √âtat ============================= ============================================ ========= SeShutdownPrivilege Arr√™ter le syst√®me D√©sactiv√© SeChangeNotifyPrivilege Contourner la v√©rification de parcours Activ√© SeUndockPrivilege Retirer l'ordinateur de la station d'accueil D√©sactiv√© SeIncreaseWorkingSetPrivilege Augmenter une plage de travail de processus D√©sactiv√© SeTimeZonePrivilege Changer le fuseau horaire D√©sactiv√© PS D:\\> Pour √©teindre mon ordinateur je dois donc activer ce droit. Gr√¢ce √† une magie occulte je peux l'activer (en r√©alit√© j'use simplement d'un impl√©mentation de la fonction RtlAdjustPrivilege de NTDLL.dll , qui permet d'ajuster les privil√®ges pour notre processus, en PowerShell) et on peut alors voir que maintenant je peux √©teindre mon poste. PS D:\\tools\\PowerShellScript\\PSReflect-Functions> RtlAdjustPrivilege -Privilege SeShutdownPrivilege -Verbose COMMENTAIRES : [RtlAdjustPrivilege] Attempting to enable 'SeShutdownPrivilege' for the current process COMMENTAIRES : [RtlAdjustPrivilege] enable for 'SeShutdownPrivilege' successful PS D:\\tools\\PowerShellScript\\PSReflect-Functions> whoami /priv Informations de privil√®ges ---------------------- Nom de privil√®ge Description √âtat ============================= ============================================ ========= SeShutdownPrivilege Arr√™ter le syst√®me Activ√© SeChangeNotifyPrivilege Contourner la v√©rification de parcours Activ√© SeUndockPrivilege Retirer l'ordinateur de la station d'accueil D√©sactiv√© SeIncreaseWorkingSetPrivilege Augmenter une plage de travail de processus D√©sactiv√© SeTimeZonePrivilege Changer le fuseau horaire D√©sactiv√© PS D:\\tools\\PowerShellScript\\PSReflect-Functions> Sauf qu'apr√®s une partie de \"CS:GO\" en compagnie d'une √©quipe russe le \"ragequit\" serait quelque peu ennuyant. C'est pour cela qu'il est possible d'activer ou de d√©sactiver des privil√®ges. Attention, ces derniers doivent √™tre contenu dans notre token d'acc√®s initiale, sinon cela serait beaucoup trop facile. Lorsque nous utilisons un programme tel \"shutdown.exe\" il va utiliser certaines fonctions de la WinAPI ( AdjustTokenPrivileges de advapi32.dll pour les curieux) pour changer ses privil√®ges, et de ce fait pouvoir dire adieu √† notre partie gagn√©e d'avance. Les listes d'acc√®s Il en existe deux types. La premi√®re est la SACL pour \"System Access Control List\" qui est vraisemblablement la plus simple. En effet, elle permet d'√©tablir un certain nombre de r√®gles concernant l'audit d'acc√®s √† l'objet portant cette liste. On peut alors d√©finir dans cette derni√®re quel √©v√©nement, pour quel utilisateur, se doit d'√™tre inscrit dans les journaux d'√©v√©nements. L'autre type se nomme DACL pour \"Discretionary Access Control List\". La DACL contient un certains nombres d' ACE (\"Access Control Entry\") qui pr√©cise le type de droit accord√© √† un objet. Leur structure est assez √©l√©mentaire. En outre, une ACE contient un header d√©terminant son type c'est √† dire acc√®s autoris√© ou refus√© et d'autres informations. Le header, quant √† lui, contient le droit garantit ou non. Ce droit est appel√© masque d'acc√®s. On √©num√®re ce que l'on appelle les droits standards qui sont √©l√©mentaires: DELETE est le droit de supprimer l'objet, je vous l'accorde il n'√©tait pas tr√®s complexe celui-l√†. READ_CONTROL est le droit de lire la SACL/DACL . WRITE_DAC est le droit de modifier les entr√©s de la DACL , c'est √† dire ajouter des ACEs . WRITE_OWNER est le droit de modifier le propri√©taire d'un objet, l'int√©r√™t √©tant que ce dernier poss√®de implicitement tous les droits souhait√©s. Ces droits standards permettent alors de construire ce que l'on appelle les droits g√©n√©riques: GENERIC_READ permet, comme son nom l'indique, de lire les attributs et propri√©t√©s d'un objet. Si c'est un fichier par exemple, ce droit permet la lecture du contenu du fichier. Son √©quivalent sous linux est le flag \"r\". GENERIC_WRITE permet la modification des propri√©t√©s et attributs de l'objet. Pour continuer dans le pr√©c√©dent exemple, ce droit permet la modification de son contenu. Son √©quivalent sous linux est le flag \"w\". GENERIC_EXECUTE permet de lire les permissions d'un objet. Factuellement si c'est un programme, il permet de le lancer. Son √©quivalent sous linux serait le flag \"x\". GENERIC_ALL est la combinaison de ces droits. Attention cependant, il est sensiblement plus fort, dans de tr√®s rare cas. Il peut s'av√©rer que la combinaison GENERIC_READ/WRITE/EXECUTE n'est pas √©quivalente √† GENERIC_ALL , il n'a donc pas d'√©quivalent dans le syst√®me au pingouin. Il en existe encore un grand nombre mais l'objectif n'est pas l'exhaustivit√©. Pour voir ces acc√®s, il faut utiliser l'onglet s√©curit√© des propri√©t√©s d'un objet. On peut √©galement utiliser notre shell pr√©f√©rer aka PowerShell (l√† pour le coup, vous n'avez pas d'excuse car PowerShell c'est g√©nial et opensource). Une commande particuli√®re est destin√©e √† cela: Get-Acl . Elle prend comme argument le chemin vers notre objet, -Path et ce sera globalement tout pour une utilisation simple. Le r√©sultat retourn√© est alors une \"table\" ce qui est assez inconfortable. Pour s'affranchir de se probl√®me d'affichage, on utilise un pipe | vers la commande Format-List (ou son alias fl ). On peut alors apercevoir entre autre le propri√©taire du fichier dans notre cas, les acc√®s accord√©s ainsi que le descripteur de s√©curit√© au format SDDL . PS D:\\tools\\PowerShellScript\\PSReflect-Functions> Get-Acl .\\ | fl Path : Microsoft.PowerShell.Core\\FileSystem::D:\\tools\\PowerShellScript\\PSReflect-Functions Owner : DESKTOP-8Q2CUHH\\Lancelot Group : DESKTOP-8Q2CUHH\\Aucun Access : BUILTIN\\Administrateurs Allow FullControl BUILTIN\\Administrateurs Allow 268435456 AUTORITE NT\\Syst√®me Allow FullControl AUTORITE NT\\Syst√®me Allow 268435456 AUTORITE NT\\Utilisateurs authentifi√©s Allow Modify, Synchronize AUTORITE NT\\Utilisateurs authentifi√©s Allow -536805376 BUILTIN\\Utilisateurs Allow ReadAndExecute, Synchronize BUILTIN\\Utilisateurs Allow -1610612736 Audit : Sddl : O:S-1-5-21-1739485902-3336647338-3362325240-1001G:S-1-5-21-1739485902-3336647338-3362325240-513D:(A;ID;FA;;;BA)(A;OICIIOID;GA;;;BA)(A;ID;FA;;;SY)(A;OICIIOID;GA;;;SY)(A;ID;0x1301bf;;;AU)(A;OICIIOID;SD GXGWGR;;;AU)(A;ID;0x1200a9;;;BU)(A;OICIIOID;GXGR;;;BU) PS D:\\tools\\PowerShellScript\\PSReflect-Functions> Si vous souhaitez plus de pr√©cisions, je vous invite √† lire mon article sur l'abus d'ACL en ActiveDirectory R√©sumons Lorsqu'un utilisateur se connecte √† sa session, des informations seront gard√©es en m√©moire dans un token d'acc√®s. Lorsqu'il souhaite d√©marrer un programme, une copie de son token est donn√©. Si ce dernier interagit avec le syst√®me, il devra utiliser ses privil√®ges pour r√©aliser certaines op√©rations. S'il n'est pas tout le temps n√©cessaire de les utiliser, lorsque l'on souhaite acc√©der √† un objet (fichier, processus ‚Ä¶) notre token d'acc√®s sert de carte d'identit√© qui sera comparer avec le contenu de la DACL du descripteur de s√©curit√© de l'objet auquel le programme/utilisateur souhaite acc√©der. En fonction des diff√©rentes entr√©s dans la liste d'acc√®s, il se verra refuser ou autoriser un certain acc√®s. J'esp√®re que vous comprenez mieux √† pr√©sent la mani√®re dont l'os de Microsoft g√®re les permissions. Si cet article vous a plu, je vous invite √† consulter mes articles sur les privil√®ges d'acc√®s ainsi que sur l'abus des ACLs en Active Directory (et oui m√™me si utile aux d√©fenseurs, ils sont aussi utile aux attaquants).","tags":"misc","url":"https://ilearned.eu.org/secu_windows.html","loc":"https://ilearned.eu.org/secu_windows.html"},{"title":"Comment fonctionne le protocole TLS","text":"TLS est un protocole que nous utilisons quotidiennement, il est notamment utilis√© dans HTTPS pour s√©curiser la connexion. TLS est le successeur de SSL, nous verrons prochainement pourquoi SSL a √©t√© abandonn√© au profit de TLS. Dans cet article, nous √©tudierons TLS1.3 qui est la derni√®re version du protocole sortie en 2018. TLS se base √† la fois sur le chiffrement asym√©trique et le chiffrement sym√©trique. Un √©change de cl√© (appel√© handshake ou poign√©e de main) a lieu au d√©but de la connexion, une cl√© secr√®te est √©chang√©e de fa√ßon asym√©trique, cette cl√© est ensuite utilis√©e pour chiffrer les donn√©es (du chiffrement sym√©trique donc). Voyons donc plus en d√©tail comment se passe un handshake avec TLS1.3. Le client envoie donc dans un premier temps un **Client Hello** qui contient entre autre : Les diff√©rents protocoles cryptographiques (pour le chiffrement asym√©trique et sym√©trique) qu'il supporte. Key Share qui correspond a la cl√© publique du client, vous vous demanderez surement comment le client peut bien envoyer sa cl√© publique s'il ne sait pas les protocoles que le serveur supporte, c'est une diff√©rence majeur par rapport √† TLS 1.2, avec TLS 1.3 le client part du principe que le serveur supporte un certain nombre de protocoles et envoie sa cl√© publique pour un de ces protocoles, s'il s'av√®re que ce n'est pas le cas, le serveur va renvoyer un HelloRetryRequest ainsi que les protocoles qu'il supporte. Le serveur r√©pond ensuite avec un **Server Hello** qui contient entre autre : Le Certificat TLS qui permet d'assurer l'authenticit√© du serveur. Le Certificate Verify qui correspond √† la signature du handshake, il est utilis√© pour s'assurer que le handshake n'a pas √©t√© modifi√© en cours de route (dans le cas d'un attaque Man In The Middle par exemple). Change Cipher Spec indique √† l'autre participant le passage √† un mode de chiffrement sym√©trique. Dans Key Share le serveur indique sa cl√© publique Finished indique enfin la fin du handshake pour le client. Le client envoie enfin pour terminer un Change Cipher Spec et Finished . Vous trouverez ici üìé un pcap d'un requ√™te avec TLS 1.3. En parcourant vous verrez que la version de TLS affich√©e est TLS 1.2, it's not a bug, it's a feature c'est en fait pour √©viter que certaines middlebox de merde üò° , utilis√©es notamment en entreprise pour espionner le trafic, bloquent le trafic pour des version de TLS au dessus de TLS 1.2. Des paires de cl√©s publique/priv√©e sont d√©riv√©es un cl√© secr√®te afin de chiffrer de fa√ßon sym√©trique les √©changes. Nous d√©taillerons bient√¥t plus en d√©tail ce fonctionnement au travers d'ECDH. Vous l'aurez s√ªrement remarqu√©, le nom de domaine est en clair dans les requ√™tes, √† la base une fonctionnalit√© appel√©e ESNI (Encrypted Server Name Indication) qui permet de chiffrer le nom de domaine dans les requ√™tes aurait d√ª √™tre impl√©ment√©e dans TLS 1.3 mais ce n'est pas encore le cas, ESNI n'est qu'√† l'√©tat de draft ‚Ä¶ üòï Une autre fonctionnalit√© importante dans TLS 1.3 est le 0 RTT, c'est une fonctionnalit√© tr√®s controvers√©e car elle ne respecte pas le principe de forward-secrecy , si un attaquant arrive √† trouver la cl√© utilis√©e pour le chiffrement sym√©trique, il pourra d√©chiffrer toutes les prochaines requ√™tes. Elle consiste, pour faire simple, √† garder une m√™me cl√© sym√©trique pour plusieurs √©changes afin de reprendre un √©change sans avoir √† faire de handshake, mais cette fonctionnalit√© est une fausse bonne id√©e‚Ä¶","tags":"misc","url":"https://ilearned.eu.org/tls.html","loc":"https://ilearned.eu.org/tls.html"},{"title":"S√©curiser votre r√©seau local avec 802.1x","text":"En entreprise comme dans un r√©seau domestique, le contr√¥le d'acc√®s au LAN (r√©seau local) est primordial pour garantir la s√©curit√© des donn√©es transmises sur ce r√©seau, on conna√Æt tous la classique authentification par mot de passe est la m√©thode d'authentification utilis√©e dans la grand majorit√© des points d'acc√®s (= AP) grand publique, mais un simple mot de passe ne permet pas, par exemple, de donner des acc√®s diff√©rents au r√©seau en fonction des utilisateurs, pour pallier √† ce probl√®me, le standard 802.1x a √©t√© cr√©√©, il est normalis√© dans la RFC . Ce standard s'appuie sur le protocole EAP que nous allons d√©tailler dans cet article. L'authenticator (un point d'acc√®s wifi dans notre exemple mais la m√™me chose peut √™tre mis en place en Ethernet) est un interm√©diaire entre l'utilisateur et l'authentication server, la majorit√© du temps un serveur RADIUS . Identity request correspond √† la demande du username au client par l'authenticator Identity response est ce nom d'utilisateur, cette information est demand√©e pour permettre √† l'Authentication Server de savoir quelle challenge demander, il existe plusieurs types de challenge en voici quelques-uns MD5 (simple mot de passe hash√© avec MD5, cette m√©thode est controvers√©e car MD5 n'est pas consid√©r√© comme s√©curis√©). SIM (authentification bas√©e sur la carte SIM). NFC (authentification bas√©e sur le protocole NFC, c'est par exemple utilis√© sur les badges d'entreprise.) Le ou les challenges sont ensuite envoy√©s tour √† tour dans des paquets Challenge Request .","tags":"misc","url":"https://ilearned.eu.org/802_1x.html","loc":"https://ilearned.eu.org/802_1x.html"},{"title":"Fonctionnement de RADIUS","text":"Une question se pose parfois, comment g√©rer facilement de l'authentification et des autorisations d'utilisateur sur un r√©seau avec plusieurs machines sans r√©pliquer la liste d'utilisateur avec les propri√©t√©s unique √† chacun sur chaque machine. Une solution pour ce genre de cas est RADIUS, c'est un protocole qui permet d'authentifier et de donner une liste de propri√©t√© pour un utilisateur. Un cas d'usage est par exemple un stockage r√©seau (aussi appel√© NAS ). Le serveur NAS va demander l'utilisateur et le mot de passe au client, il va ensuite se connecter avec le serveur RADIUS pour valider l'authentification. √Ä chaque requ√™te le NAS transmet les identifiants que le client lui a envoy√© afin de savoir s'il peut acc√©der √† la ressource demand√©e. Le client RADIUS (ici le NAS ) doit s'authentifier aupr√®s du serveur RADIUS, pour se faire il utilise un secret qui est partag√© entre le serveur RADIUS et le NAS . Ce secret permet aussi de chiffrer les identifiants de l'utilisateur via un \" xor \", un xor est un moyen de chiffrer sur base d'une cl√© unique, on parle donc de chiffrement sym√©trique. La communication entre le serveur RADIUS et son client se base sur UDP (il peut aussi passer par TCP , mais nous n'en parlerons pas), le client doit donc √™tre capable de g√©rer la retransmission dans le cas ou aucune r√©ponse ne lui est accord√©e. La phase d'authentification du client se base sur un paquet contenant l'utilisateur et le mot de passe. Ce paquet est nomm√© Access Challenge , il contient par exemple l'attribut User-Name = ramle et User-Passsword = phrase-de-passe . Le client re√ßoit ensuite une r√©ponse du serveur, si le client RADIUS n'est pas connu du serveur il ne recevra pas de r√©ponse. Si le client est connu alors, le serveur peut r√©pondre de 3 mani√®res Access-Accept en cas d'identifiant valide Access-Reject en cas d'identifiant invalide Acces-Challenge si l'authentification requiert plus de param√®tre, par exemple un code PIN ou un carte d'acc√®s. La r√©ponse du serveur inclut aussi des informations suppl√©mentaire appel√© attribut , ce champs peut contenir des informations sur l'adresse IP qui doit √™tre assign√© √† l'appareil, √† la VLAN dans le quel il doit se trouver et bien d'autre param√®tre. Le paquet RADIUS se forme en plusieurs partie : Code : Il d√©finit le type de paquet Identifier : Il identifie le paquet, ce m√©canisme permet de d√©tecter une duplication, ou de savoir √† quelle demande correspond la r√©ponse car la r√©ponse garde le m√™me identifiant que la demande. Authenticator : Il authentifie la demande du client ou du serveur Attributes : il permet de donner les attributs sp√©cifiques au client La partie Authenticator du paquet dans la requ√™te Access Challenge est int√©ressante √† √©tudier, cette partie ne contient que 16bits et n√©cessite un haut taux de confidentialit√© car il contient le mot de passe utilisateur. On utilise xor et le secret √©voqu√© plus haut, dans le cas ou le password est trop long, il est alors hash√© en MD5 puis transform√© via un xor . RADIUS g√®re aussi l'itin√©rance, le serveur RADIUS du r√©seau local fera donc un proxy pour renvoyer la requ√™te au serveur qui g√®re l'utilisateur. Le canal peut √™tre s√©curis√© de plusieurs mani√®res, soit un tunnel chiffr√© entre les 2, ou bien en s√©curisant le canal avec le protocole TLS. J'esp√®re que cette article vous aura plus :), on se retrouve demain pour parler de 802.1x , un protocole utilisant RADIUS.","tags":"misc","url":"https://ilearned.eu.org/RADIUS.html","loc":"https://ilearned.eu.org/RADIUS.html"},{"title":"Comment fonctionne HTTP/3 ?","text":"Il n'y a pas longtemps nous avions d√©couvert le fonctionnement d' HTTP , et diff√©rentes versions de ce protocoles, mais l'une d'elle n'a pas √©t√© vue : HTTP/3, cette version apporte un changement sur la m√©thode de transport en se basant sur QUIC qui lui m√™me utilise UDP au lieu de TCP . Pour commencer, regardons de plus pr√®s QUIC, il existe pour le moment deux versions de ce protocole, une faite par Google qui n'a pas √©t√© standardis√©e, et une qui est en cours de r√©daction pour √™tre publi√©e sous forme d'une RFC √† l'IETF (l'organe qui s'occupe de la publication des RFC). La version de Google se concentre sur HTTP/3, contrairement √† la version de l'IETF qui veut faire de QUIC un protocole de transport servant pour d'autres usages que HTTP , pour le DNS par exemple. Pour le moment l'IETF (qui se base en partie sur les travaux de Google) est encore au stade de r√©daction de la norme et se concentre sur HTTP/3 comme usage pour la premi√®re version. Cet article se basera sur les travaux de l'IETF et non ceux de Google. Pour commencer, QUIC se base sur UDP et veut r√©soudre certains probl√®me de TCP , avec HTTP/2 par exemple, plusieurs transferts sont effectu√©s sur un seul flux TCP , je vous renvoie vers l'article sur HTTP qui explique en d√©tail ce concept, avec TCP si dans la liste des paquets en attente un paquet se perd tous les paquets avant celui perdu devront attendre le renvoi. On peut faire un parall√®le avec un embouteillage de voiture, si une voiture bloque la route, celles qui pr√©c√®dent la voiture devront attendre son passage. TCP rajoute aussi une latence importante due aux diff√©rents handshakes, UDP n'utilise pas de s√©quence de handshake. QUIC en rajoute pour assurer un minimum de fiabilit√©. On compte au total 4 aller-retours pour r√©cup√©rer une page (ou un code d'erreur) contre 6 dans les versions d'HTTP bas√©e sur TCP . Le client commence par l'envoi d'un \"hello\" pour donner diff√©rents param√®tres sur lui, ensuite le serveur r√©pond en envoyant directement le certificat et les informations pour commencer l'√©change de donn√©e, le client envoie ensuite sa requ√™te avec la m√©thode. Le client finit par y r√©pondre par le code de retour ou la page demand√©e. QUIC fonctionne sur UDP comme dit plus haut, il force un certain niveau de s√©curit√© en imposant TLS en version 1.3, pour les communications. Il offre aussi une certaine fiabilit√© qu'UDP ne poss√®de pas, rappelez-vous, UDP ne v√©rifie rien. QUIC r√©sout ce probl√®me en ajoutant une couche qui permet de g√©rer une retransmission de paquet au cas o√π celui-ci se perdrait en chemin, il permet aussi un contr√¥le de la congestion, la congestion en r√©seau c'est la saturation du r√©seau en lui m√™me, cela cause un ralentissement ou une perte de paquet dans les cas extr√™mes, le protocole est donc pas loin de TCP sur la fiabilit√©. Sur un seul canal UDP , QUIC permet de faire placer plusieurs flux en simultan√©. Pour le moment, nous avons vu principalement QUIC, la raison est que HTTP/3 n'apporte pas grand chose, c'est HTTP/2 adapt√© pour passer au dessus de QUIC, il y a quelques diff√©rences mineures comme la compression des en-t√™tes qui est adapt√© au protocole, mais les modifications sont mineure et viennent surtout adapt√© HTTP pour QUIC. Le rapprochement avec HTTP/2 est plut√¥t logique d'ailleurs si on regarde la chronologie le travail sur HTTP/3 √† commenc√© dans la m√™me p√©riode. Un point utile √† aborder est de savoir comment le client sait si il doit communiqu√© en HTTP/3 ou non. En effet, les anciennes version d'HTTP utilise TCP contrairement √† HTTP/3 qui utilise UDP . Pour informer le navigateur de la pr√©sence d'HTTP/3 l'en-t√™te Alt-Svc √† √©t√© cr√©e, elle indique le port UDP sur le quel le client doit aller voir, on peut aussi via l'en-t√™te indiquer un domaine diff√©rent. L'am√©lioration qu'apporte HTTP/3 est relativement mineure mais se r√©v√®le assez utile, sur une connexion stable avec peu de perte de paquet la diff√©rence n'est pas forc√©ment visible, mais sur un r√©seau satur√© avec un grand nombre de perte ne pas renvoyer toute la queue √† chaque perte est un gain non n√©gligeable. Une observation faite par certains est que HTTP/3 demande plus de CPU pour le serveur, √ßa peut √™tre un frein pour le d√©ploiement. Il faut aussi gard√© en t√™te que QUIC est assez nouveau, les impl√©mentations ne sont pas encore parfaite, le temps dira si ce protocole vaut le coup ou non. Niveau performance, HTTP/3 apporte un gain au niveau de la latence gr√¢ce √† la poign√©e de main r√©duite, pour ce qui est de la vitesse de chargement, la prioritisation des flux, et la possibilit√© d'envoyer sur plusieurs flux en simultan√© permet de gagner un peu. Selon Cloudflare HTTP/3 am√©liore le temps d'√©tablissement de la premi√®re connexion de 12,4%, pour ce qui est du chargement d'une page, ici leur propre blog, le temps diminue entre 1 et 4%, c'est au final assez peu, mais sur une connexions assez lente quelques pour-cent n'est pas n√©gligeable. Si vous regardez un peu en d√©tail votre navigateur vous remarquerez qu'HTTP/3 n'est pas encore activ√© par d√©faut, en effet ce protocole bien que prometteur n'est pas encore standardis√© et est tr√®s minoritaire. Si par curiosit√© vous voulez tout de m√™me activ√© dans about:config sur votre firefox vous pouvez changez la configuration network.http.http3.enabled vers true . Sachez toutefois que des sites comme celui de Cloudflare o√π de Google int√®grent d√©j√† HTTP/3 ! J'esp√®re que cet article vous aura plus :), on se retrouve demain pour parler de radius.","tags":"misc","url":"https://ilearned.eu.org/http3.html","loc":"https://ilearned.eu.org/http3.html"},{"title":"S√©curiser NTP, √† quoi bon ?","text":"Nous avons vu jeudi comment fonctionne le protocole NTP mais il reste un dernier point √† aborder, comment assurer l'int√©grit√© des donn√©es transmises via NTP ? Vous vous demanderez s√ªrement, √† quoi bon s√©curiser le protocole NTP, alors qu'il ne transmet que le temps ü§î. Le temps est une donn√©e tr√®s importante en informatique, plus qu'on ne pourrait le penser de prime abord, il est utilis√© dans de nombreux protocoles cryptographiques, comme par exemple dans TLS ou DNSSEC avec le syst√®me de TTL (time to live). Pour s√©curiser NTP de nombreux protocoles ont √©t√© propos√©s et mis en place, nous en citerons ici trois. Le chiffrement sym√©trique Dans NTP3 est ajout√© le syst√®me d'authentification par cl√©s sym√©triques, un secret partag√© est √©chang√© la premi√®re fois entre le client et le serveur et c'est ce secret qui est ensuite utilis√© pour s√©curiser la connexion. Mais cette m√©thode pose un gros probl√®me, il est n√©cessaire d'√©changer une cl√© secr√®te la premi√®re fois, elle est donc tr√®s difficilement automatisable et impossible √† d√©ployer √† grand √©chelle. Autokey Une autre approche a √©t√© autokey , ce syst√®me utilis√© du chiffrement asym√©trique et r√©sous donc les probl√®mes qui se posaient avec le chiffrement sym√©trique, en partie seulement, car le protocole autokey a de grosses lacunes en terme de s√©curit√©, un comble, effet la taille du cookie utilis√© pour s'authentifier avec autokey est de seulement 32 bits, ce qui le rend tr√®s vuln√©rable, mais ce n'est pas le seul probl√®me d'autokey, le client n'est identifi√© que par son IP, un attaquant pourrait donc se faire passer pour le client et d√©rober le cookie. Network Time Security (NTS) Pour pallier aux faiblesses de ces deux protocoles, un nouveau protocole est un cours de cr√©ation, NTS (standardis√© dans la RFC 8915 il se base sur le principe du chiffrement asym√©trique sans les probl√®mes d'autokey. Ce protocole se base en partie sur TLS pour l'√©change de cl√©s, il utilise ensuite les parties des headers sp√©cifiques √† NTP pour s√©curiser le reste de la connexion. C'est un protocole prometteur mais qui n'est malheureusement pas encore assez impl√©ment√©.","tags":"misc","url":"https://ilearned.eu.org/securiser_ntp.html","loc":"https://ilearned.eu.org/securiser_ntp.html"},{"title":"NTP, comment √ßa marche ?","text":"Depuis la d√©mocratisation d'internet et de l'informatique en g√©n√©ral, une question s'est pos√©e, comment faire en sorte que les horloges de tous les ordinateurs soient coordonn√©es ? En septembre 1985 une premi√®re version du protocole NTP (Network Time Protocol) est publi√©e dans la RFC 958 , ce protocole se base sur UDP pour sa l√©g√®ret√©. NTP fonctionne sur une typologie de r√©seau dite mesh , elle est d√©coup√©e en strates afin de d√©livrer un temps √©quivalent partout et d'assurer une redondance. Les serveurs de strate 1 sont les horloges principales, le temps qu'elles donne peut provenir de diff√©rentes sources comme le GPS ou une horloge atomique . Les serveurs des strates plus basse s'√©changent entre eux leur temps afin de v√©rifier qu'il correspond bien. Quand nous, utilisateurs, acc√©dons √† un serveur NTP, on acc√®de bien souvent √† un serveur de strate 2 ou 3. Voici √† quoi ressemble une requ√™te NTP : √áa fait pas mal de parties üòÑ. Nous ne commenterons ici que les plus importantes. LI, Leap Indicator indique une seconde intercalaire imminente. Une seconde intercalaire correspond, pour faire simple, √† une seconde ajout√©e sur toutes les horloges occasionnellement afin de synchroniser le temps universel coordonn√© (UTC) avec le temps solaire. VN, Version Number indique simplement la version de NTP utilis√©e. Mode, indique le mode dans lequel est l'√©metteur, client, serveur etc. Poll correspond √† l'intervalle √† laquelle le client doit reinterroger le serveur NTP. Root delay correspond au temps pour faire un aller-retour vers un serveur de strate 1. Et root dispersion est une estimation de la marge d'erreur du serveur de strate 1. Reference ID correspond au type d'outil utilis√© par le serveur root (strate 1) comme par exemple le GPS ou une horloge atomique. Reference Timestamp est le temps de la derni√®re mise √† jour via NTP. Les trois autres timestamps sont d√©cris ci-dessous Le destination timestamp n'est logiquement pas inclut dans les headers, il est dans ce sch√©ma √† titre informatif. √áa fait beaucoup de param√®tres üòÖ Mais gr√¢ce √† toutes ces informations on peut avoir une pr√©cision de l'ordre de quelques nanosecondes en soustrayant le temps de transfert ! Un dernier probl√®me se pose, comment assurer le fait que le serveur NTP ne se fasse pas usurper ? Nous avons d√©j√† √©tudi√© dans d'autres articles des moyens de signature cryptographique, NTP impl√©mente aussi une solution de ce type que nous √©tudierons tr√®s prochainement :). Merci d'avoir lu cet article, j'esp√®re qu'il vous a plu üòÑ.","tags":"misc","url":"https://ilearned.eu.org/ntp.html","loc":"https://ilearned.eu.org/ntp.html"},{"title":"Comprendre le protocole UDP","text":"Nous avions r√©cemment vu le fonctionnement de TCP , ce protocole essaye d'avoir la meilleur fiabilit√© possible pour la transmission, mais un certain nombre d'√©changes sont requis pour v√©rifier l'int√©grit√© du flux ce qui rajoute de la latence qui dans certains cas, est probl√©matique. UDP est un protocole qui tente de r√©soudre ce probl√®me. UDP est l'acronyme de User Datagram Protocol (traduit par protocole de datagramme utilisateur), ce protocole se base sur IP et fait partie de la couche transport du mod√®le OSI . Contrairement √† TCP il ne fait pas de \"poign√©e de main\" (ou handshake en anglais) et ne n√©cessite pas d'accus√© de r√©ception (ACK), cette mani√®re de fonctionner le rend plus tol√©rant √† un r√©seau d√©fectueux et lui permet un latence plus faible. Il n'est utile que dans des cas o√π une perte de paquet ne pose pas un soucis important. UDP est utilis√© dans certains protocole tr√®s utilis√© comme NTP, DNS, ou plus g√©n√©ralement les applications qui ont besoins de temps r√©el comme les jeux vid√©o ou certains services de streaming. Comme je l'ai dis plus haut UDP ne v√©rifie pas la bonne r√©ception d'un paquet (contrairement √† TCP avec son syst√®me d'ACK), la machine envoie donc le paquet sans forc√©ment attendre un retour. Ce protocole est bien plus simple que TCP dans sa conception. Un paquet UDP se compose tel que d√©crit sur ce sch√©ma : Comme on peut le voir, il y a un minimum d'information compar√© √† TCP, le port source qui permet si besoin de r√©pondre, le port de destination, la longueur totale du segment UDP (donn√©es comprises), une somme de contr√¥le (hash) et les donn√©es en elle m√™me, chaque entr√©e de l'en-t√™te fait 16 bits ce qui au total fait 64 bits pour la partie header contre 192 avec TCP ! La partie donn√©es a une longueur variable. Comme √† notre habitude, regardons une capture r√©seau : On remarque directement la simplicit√©, 2 requ√™tes seulement pour un aller retour, chaque paquet est aussi assez l√©ger, moins de 100 octets √† chaque fois, pour ce qui est des nombres \"0.000000\" et 0.000093\" il s'agit du temps o√π ont √©t√© captur√©s chaque paquet. Si vous voulez regarder plus en profondeur la capture r√©seau, je vous laisse le fichier disponible ici . C'est tout pour cet article sur UDP, j'esp√®re que vous l'aurez appr√©ci√©. On se retrouve demain pour parler de NTP :).","tags":"Today I Learned","url":"https://ilearned.eu.org/udp.html","loc":"https://ilearned.eu.org/udp.html"},{"title":"D√©centraliser, une priorit√©","text":"Internet est un grand r√©seau de r√©seau tous interconnect√©s de mani√®re diff√©rentes, la conception permet en th√©orie une redondance importante, mais dans les faits ce n'est pas forc√©ment le cas. En effet, beaucoup de services sont concentrer sur un nombre retreint d'acteur La concentration de ressource chez un nombre restreint d'acteurs pose un soucis, si un acteur tombe au plus il est utilis√© au plus le nombre de personnes impact√©es sera important, c'est ce pour quoi ne pas passer par les g√©ants d'un secteur est un choix non n√©gligeable, cela permet une meilleur redondance d'internet. Une autre probl√©matique d'utiliser des gros acteurs est leur possibilit√© √† imposer des conditions pas forc√©ment √©thique, par exemple Cloudflare, qui promet une protection contre les d√©nis de services, mais au vu du coups d'une infrastructure contre les attaques par d√©ni de service leur service gratuit n'est en r√©alit√© qu'un bon coup de pub pour leur offres payantes, qui est devant un grand nombre de sites, dans un premier temps si ils tombent internet le ressent de mani√®re exag√©r√©e, en plus d'emp√™cher une navigation agr√©able au utilisateur du r√©seau Tor. Qui je le rappelle, ne sert pas forc√©ment qu'aux cybercriminels comme aime le faire croire certains article :), ce r√©seau sert aussi √† contourner des blocage en vigueur dans certains pays, ou √† √©viter l'espionnage. Il n'y a bien sur pas que Cloudflare qui pose soucis, je les cites parce que je vois une recrudescence de son utilisation, qui, qui plus est n'est pas forc√©ment justifi√© ou utile je vous invite √† lire https://codeberg.org/crimeflare/cloudflare-tor.git . Bien sur ce ne sont pas les seuls, tous les grands acteurs comme Amazon avec AWS, Google avec GCP ou encore, bien que peu pr√©sent dans nos contr√©es, Alibaba Cloud. Il n'y a bien sur pas que l'h√©bergeur qui est important, mais les diff√©rents services qu'en temps qu'utilisateurs finaux nous sommes amen√©s √† utiliser. Souvent ces outils sont tr√®s pratiques, mais que faire si celui ci n'est pas en ligne, l'entreprise disparait ou tout simplement supprime vos donn√©es ? Ce ne sont pas des cas invent√©s, pour ce qui est de l'indisponibilit√© on peut simplement observer les g√©ants, Google avait une panne presque total √† cause d'un quota (https://status.cloud.google.com/incident/zall/20013) de disque rempli. Pour ce qui est de la disparition de g√©ant on peut regarde Yahoo, qui fut un temps √©tait leader et n'est plus qu'un souvenir de nos jours. La suppression de contenu est un cas plus \"compliqu√©\" √† aborder, souvent les conditions d'utilisations que vous acceptez en utilisant un service stipulent un grand nombre de raisons qui permettent sans trop de difficult√©s d'√©vincer un compte on peut prendre l'exemple de YouTube, bien connu pour ce genre de pratique, qui va jusqu'√† fermer certaines chaines qui parlent de s√©curit√© informatique, il y a aussi Github qui a supprim√© youtube-dl de sa plateforme sur une demande ill√©gitime, youtube-dl est de nouveau pr√©sent sur Github mais sans une communaut√© solide il est compliqu√© de contrer une telle suppression. Tout centraliser au m√™me endroit pose aussi un soucis de vie priv√©e, si par exemple vous avez vos mails, vos fichiers, votre agenda chez un seul acteur celui peut revendre ou utiliser ces donn√©es √† des fin plus ou moins douteuses, et m√™me si l'acteur est honn√™te, un pirate qui r√©ussirait √† s'introduire dans le syst√®me y trouverait une mine d'or pour usurper une identit√©, revendre √† des agences de publicit√©s etc. Apr√®s avoir parl√© des probl√©matique, il est int√©ressant de regarder les solutions. Pour ce qui est des r√©seaux sociaux il existe des alternatives comme Mastodon en √©quivalent √† Twitter ou Facebook, pour Instagram je vous conseille Pixelfed et pour Youtube il y a PeerTube, ces solutions peuvent poser un probl√®me, leur manque d'utilisateur mais ce n'est pas pour autant que aucun contenu de qualit√© y est pr√©sent, bien au contraire il y a beaucoup de contenu tr√®s qualitatif. Un soucis de ce genre de solution c'est l'h√©bergement, tout le monde n'a pas forc√©ment l'envie de g√©rer soit m√™me une instance, ou bien m√™me la comp√©tence. Pour palier √† √ßa il y a un collectif : https://chatons.org qui liste un nombre d'association. Pour ce qui est du choix d'un h√©bergeur autre que les g√©ants on peut regarder dans un premier temps les entreprises plus locales, par exemple ce blog est h√©berg√© chez https://www.tetaneutral.net/ une petite association fran√ßaise, en h√©bergeurs plus \"business\" il y a en France de tr√®s bonnes entreprises, comme Scaleway ou OVH. J'esp√®re que cette article plus politique est moins technique vous aura plus :). Nous aimerions remercier toutes les personnes suivant r√©guli√®rement ce blog, les statistiques sont incroyables, au d√©but nous pensions juste avoir quelques visiteurs mais c'est tout le contraire qui s'est produit, encore hier nous avons plus de 300 personnes qui sont pass√©es sur le blog et certains articles comme celui sur TCP a re√ßu plus de 1300 vues ! Les commentaires que vous laissez pour des corrections, ou des remerciements nous motivent aussi beaucoup, alors un grand merci üòä. Nous avons un dernier messages, poster tous les jours deviens de plus en plus compliqu√© surtout avec la reprise des cours en pr√©sentiel et la p√©riode d'examens qui approche, c'est pour cela que l'on passe maintenant √† un post deux jours sur trois, au lieu de chaque jours. Ce qui fait que ce n'est pas demain qu'on se retrouve, mais mercredi pour parler de UDP .","tags":"misc","url":"https://ilearned.eu.org/decentralisation.html","loc":"https://ilearned.eu.org/decentralisation.html"},{"title":"Comment fonctionne le tracking par ETag","text":"De plus en plus de navigateurs mettent en place des mesures pour bloquer le tracking, Firefox par exemple, bloque par d√©faut les cookies third party. Pour contourner ces mesures de protection des utilisateurs, les entreprises de tracking sont √† la recherche d'autres moyens de pister les utilisateurs, ETag est l'un d'eux. Nous en avons bri√®vement parl√© dans l'article sur HTTP , l'en-t√™te ETag est dans le cas du serveur web Nginx que nous prendrons comme exemple ici, un condensat de la date de modification et de la longueur (lenght) du fichier demand√©. Ce hash a √©t√© cr√©√© pour permettre au navigateur de savoir s'il y a eu des changements sur un fichier et s'il doit montrer la version du fichier conserv√©e en cache √† l'utilisateur ou t√©l√©charger √† nouveau le fichier depuis le serveur. Ce syst√®me d'ETag peut cependant √™tre d√©tourn√©, afin de v√©rifier si les ETag correspondent, le client envoie l'ETag de la version qu'il a du fichier au serveur, le serveur peut donc, pour chaque utilisateur, servir un fichier diff√©rent (qui aura donc un ETag diff√©rent) et gr√¢ce √† cet ETag savoir quel utilisateur a consult√© quelle page √† quelle moment. Des entreprises comme Hulu ou Spotify ont √©t√© √©pingl√©es pour avoir mis en place cette pratique, qui ne respecte √©videmment pas le RGPD. Merci d'avoir lu cet article, en esp√©rant qu'il a √©t√© clair :) On se retrouve demain pour parler de d√©centralisation !","tags":"misc","url":"https://ilearned.eu.org/etag.html","loc":"https://ilearned.eu.org/etag.html"},{"title":"Le fonctionnement d'HTTP","text":"Le web est l'usage le plus connu d'internet, un protocole assez vieux (mais pas aussi vieux qu'internet) se cache derri√®re ce succ√®s : HTTP. HTTP est l'acronyme d'Hyper Text Transfer Protocol (protocole de transfert hypertexte si l'on traduit en fran√ßais), il a √©t√© invent√© pour palier √† certains manques de FTP qui √† l'√©poque √©tait majoritaire, un des points principaux est la notion de format de donn√©es, c'est √† dire indiquer au client quel est le type de donn√©e, cela permet au client de pouvoir interpr√©ter et afficher sans demander √† l'utilisateur ce qu'il doit faire de chaque fichier. Cette notion de \"format de donn√©es\" s'appelle le MIME. HTTP a connu plusieurs versions, l'initiale √©tant la 0.9 (not√©e HTTP/0.9) qui n'a jamais √©t√© standardis√©e dans une RFC, une RFC (pour request for comment, soit demande de commentaires en fran√ßais) est un document technique identifi√© par un num√©ro d√©finissant des proc√©dures ou protocoles, ces documents sont accessibles sur https://www.rfc-editor.org/rfc/ (ou gemini://gemini.bortzmeyer.org/rfc-mirror/rfc-index.gmi via Gemini ), l'usage de cette version d'HTTP est assez marginal de nos jours. Quelques ann√©es plus tard est sorti au travers d'une RFC (la 1945 ) HTTP/1.0 cette RFC s'occupe surtout de pr√©ciser comment HTTP fonctionne, il n'apporte pas d'√©volution avec la version 0.9. Assez rapidement HTTP/1.1 sort, cette version apporte certaines optimisations, comme l'envoi de plusieurs requ√™tes en simultan√©. Le fonctionnement d'HTTP se base sur le protocole TCP , par d√©faut le port utilis√© est le 80. Pour demander ou envoyer des contenus on utilise des \"m√©thodes\", une m√©thode est une commande envoy√©e au serveur. On peut en citer plusieurs : GET : Demande une ressource HEAD : Demande uniquement les informations POST : Envoie des donn√©es La liste n'est pas compl√®te, je vous laisse rechercher par vous m√™me pour plus d'informations √† ce propos ;). On peut regarder plus en profondeur HTTP en regardant les transmissions r√©seaux : La partie data, celle qui contient la page en elle m√™me n'est pas directement visible ici, je vous laisse regarder le dump r√©seau sur wireshark, il est disponible ici . Un autre aspect int√©ressant d'HTTP sont les en-t√™tes (headers) qui donnent des informations au client √† propos du serveur, et inversement. C√¥t√© client par exemple, on a l'en-t√™te \"Host\" qui donne le nom de domaine demand√© par le client, cela permet de distribuer un contenu diff√©rent en fonction de celui-ci. Le serveur peut lui donner le type de contenu via \"Content-Type\". Il y a beaucoup d'autres en-t√™tes possibles, si vous voulez regarder celle d'une URL la commande curl le permet via l'option -I , pour https://ramle.be par exemple : % curl -I https://ramle.be HTTP/2 200 server: nginx date: Sat, 08 May 2021 14 :40:55 GMT content-type: text/html ; charset = utf-8 content-length: 1992 last-modified: Fri, 23 Apr 2021 18 :18:34 GMT vary: Accept-Encoding etag: \"60830f7a-7c8\" content-security-policy: default-src 'none' ; style-src cdn.ramle.be ; img-src cdn.ramle.be x-frame-options: SAMEORIGIN x-xss-protection: 1 ; mode = block x-content-type-options: nosniff referrer-policy: same-origin x-permitted-cross-domain-policies: master-only expect-ct: max-age = 60 , enforce permissions-policy: accelerometer =() , camera =() , geolocation =() , gyroscope =() , magnetometer =() , microphone =() , payment =() , usb =() strict-transport-security: max-age = 31536000 ; includeSubDomains ; preload accept-ranges: bytes On remarque sur la premi√®re ligne la version d'HTTP, ici c'est la version 2. On voit ensuite la liste des en-t√™tes : content-type indique le type de contenu (le MIME ) etag indique une suite de caract√®res ASCII, cette cha√Æne change si le contenu distant change, cela permet de mettre en cache les ressources. Il n'y a pas de m√©thode d√©finie pour la g√©n√©ration de cette cha√Æne de caract√®res. Je n'ai d√©crit ici que les en-t√™tes qui me semblait importants pour cet article, beaucoup d'autres en-t√™tes restent tr√®s utiles mais moins utilis√©s, souvent orient√©s s√©curit√©, certains feront surement l'objet d'un article prochainement ;). Si vous voulez des informations plus pr√©cises sur celle-ci je vous laisse aller voir la documentation de MDN qui est assez compl√®te. J'ai cit√© plus haut la version 2 d'HTTP (not√©e HTTP/2) sans expliquer les changements apport√©s par cette version, nous allons donc dans ce paragraphe voir les diff√©rences avec HTTP/1.1, pour commencer l'impl√©mentation faite par beaucoup de navigateurs impose le chiffrement via HTTPS (on reparlera plus bas d'HTTPS), un autre changement est dans le transport lui m√™me, HTTP/1.1 se base sur du texte, l√† ou HTTP/2 utilise du binaire, √ßa le rends plus compact et facile √† parser, mais non lisible par un humain sans outil sp√©cifique. Il y a aussi un changement dans la connexion TCP elle m√™me, au lieu de faire une connexion TCP par ressource, on utilise une seule connexion pour toutes les ressources le gain latence est assez important au vu du nombre d'aller-retour TCP . Vous avez probablement remarqu√© qu'HTTP ne pr√©sente presque aucun m√©canisme de s√©curit√© de base, il n'est en effet pas possible de v√©rifier l'authenticit√© des ressources ni d'emp√™cher un attaquant d'espionner la connexion, pour r√©soudre ce probl√®me HTTPS est n√©, il s'agit simplement de faire passer HTTP via TLS, pour ce qui est de la v√©rification on se base sur les autorit√©s de certification, contrairement √† d'autres protocoles comme Gemini , je vous invite √† aller voir l'article sur DANE pour plus de d√©tails √† propos des autorit√©s de certification. HTTP permet de r√©duire la taille des donn√©es envoy√©es en les compressant, les deux algorithmes utilis√©s pour compresser les donn√©es sont gzip et brotli, le client peut dire au serveur lequel de ces algorithmes il supporte via l'en-t√™te \" Accept-encoding \". C'est tout pour l'article d'aujourd'hui, j'esp√®re qu'il vous aura plus :), On se retrouve demain pour parler de radvd .","tags":"misc","url":"https://ilearned.eu.org/http.html","loc":"https://ilearned.eu.org/http.html"},{"title":"IPv6, il est grand temps de migrer","text":"D√©cembre 1998, c'est la date de parution de la RFC 2460 introduisant IPv6, aujourd'hui, seulement 26% des sites les plus visit√©s en France sont accessibles en IPv6 d'apr√®s l'Arcep . Faisons donc un petit tour d'horizon de l'adoption d'IPv6. IPv6 a √©t√© cr√©√© pour r√©pondre √† une probl√©matique simple, le manque croissant d'IPv4. En effet, avec IPv4 la quantit√© d'IPs total est th√©oriquement de 4 294 967 296 , th√©oriquement car certains blocs d'IPs sont r√©serv√©s √† des usages priv√©s comme par exemple 10.0.0.0/8. Le nombre de 4 milliards d'IPs peut sembler √©norme, mais cela ne repr√©sente qu'une IP pour deux personnes sur terre, de plus beaucoups d'IPs sont allou√©es (plus d'informations sur l'allocation des IPs ici üòâ) mais pas utilis√©es, comme par exemple Apple qui monopolise un /8 soit 16 777 216 IPs qui n'est presque pas utilis√© ! Avec IPv6 le nombre total d'IPs th√©oriquement disponible est de 340 282 366 920 938 463 463 374 607 431 768 211 456 , IPv6 permet donc largement de pallier √† ce probl√®me de p√©nurie d'IPv4. Une adresse IPv6 typique ressemble √† √ßa 2a03:7220:8083:3c00::1 elle est cod√©e sur 128 bits. Vous vous demandez s√ªrement ce √† quoi correspondent les :: vers la fin de l'adresse, ils correspondent simplement √† un remplissage avec des 0 afin d'atteindre le nombre de 128 bits. Par exemple : 2a03:7220:8083:3c00::1 correspond en r√©alit√© √† 2a03:7220:8083:3c00:0000:0000:0000:0001 . Les op√©rateurs ont d√©velopp√© plusieurs techniques pour contrer √† ce manque croissant d'IPv4, comme par exemple le CG-NAT, pour ceux qui ne le sauraient pas, le NAT c'est basiquement le fait de partager une seule IP publique entre plusieurs appareils (nous aborderons le NAT plus en d√©tail plus tard ;)) le CG-NAT c'est donc du NAT mais √† l'√©chelle d'une rue, d'un quartier. Le probl√®me principal du NAT c'est qu'il emp√™che de nombreuses applications et protocoles de fonctionner, comme par exemple le Torrent ou m√™me Google Maps ! Il emp√™che aussi d'h√©berger des services chez soi car seule une plage de ports est allou√©e au client, il faut donc avoir la chance de tomber sur la plage contenant les ports 80 et 443 pour pouvoir auto-h√©berger un site web par exemple. La solution √† ces maux est donc IPv6, mais comme nous l'avons vu en introduction son d√©ploiement prend du temps, beaucoup de temps, dans son rapport annuel l'Arcep pointait du doigt la lenteur du d√©ploiement d'IPv6, surtout chez certains op√©rateurs, mais aussi chez de nombreux h√©bergeurs qui ne fournissent pas d'IPv6 par d√©faut √† leurs clients ! Un des raisons de la lenteur du d√©ploiement d'IPv6 est le fait qu'utilisateurs et h√©bergeurs se renvoient syst√©matiquement la balle, les uns se demandant √† quoi bon avoir de l'IPv6 si tous les sites qu'ils visitent sont disponibles en IPv4, les autres disant qu'il est inutile de d√©ployer IPv6 puisque les clients ne sont en majorit√© pas √©quip√©s. Cette attitude dilatoire a pour cons√©quence de ralentir le d√©ploiement d'IPv6 au d√©triment des petits h√©bergeurs associatifs qui n'ont pas forc√©ment les moyens d'acheter des ranges d'IPv4 souvent tr√®s couteuses. Il existe un autre frein, et pas des moindres, au d√©ploiement et l'utilisation massive d'IPv6, le r√©seau IPv6 est actuellement divis√© en deux, en effet, Cogent un tr√®s gros fournisseur de transit refuse de peer (d'√©changer ses routes) avec Hurrican Electric, un autre mastodonte du secteur. Ainsi, depuis le r√©seau IPv6 de Cogent il est impossible d'acc√©der √† he.net (le site de Hurrican Electric) en IPv6. Ce bloquage dure depuis 2009, et malgr√© les nombreuses demandes de Hurrican Electric, ces deux entreprises ne parviennent pas √† un accord financier. Nous finirons donc cet article sur ce joli g√¢teau, merci beaucoup de l'avoir lu, si vous souhaitez savoir si vous avez de l'IPv6 je vous invite √† faire le test sur test-ipv6.com . Si vous n'en avez pas renseignez-vous, il existe probablement une d√©marche pour obtenir de l'IPv6 de la part de votre op√©rateur üòâ, sauf si vous √™tes chez orange, pas du bol :'(, il existe cependant des personnes qui offrent des tunnels IPv6 comme EnPLS par exemple.","tags":"misc","url":"https://ilearned.eu.org/ipv6.html","loc":"https://ilearned.eu.org/ipv6.html"},{"title":"Gemini, une alternative viable √† HTTP ?","text":"Hey üëã, aujourd'hui on parle du protocole Gemini, Gemini est un protocole alternatif √† HTTP ou Gopher pour ne citer qu'eux, cr√©√© en Juin 2019 avec pour objectif d'√™tre beaucoup plus l√©ger qu'HTTP, et de mieux respecter la vie priv√©e des utilisateurs, en effet, avec Gemini, pas de JS, de cookies ou de eTag, le tracking des utilisateurs est quasi impossible. Gemini n'a pas √©t√© cr√©√© pour concurrencer HTTP mais bien pour offrir une alternative plus l√©g√®re et s√©curis√©e aux utilisateurs. Ce protocole embarque d'office le protocole TLS, il n'y a donc contrairement √† HTTP pas la possibilit√© d'avoir des communications en clair. Ce protocole est bas√© en partie sur HTTP 0.9 et essentiellement textuel, mais des images peuvent aussi √™tre int√©gr√©. Une requ√™te Gemini est tr√®s simple, le client demande un fichier sur le serveur cible, le serveur r√©pond avec un code d'erreur (ici, 20 = OK), le type de fichier, le plus souvent text/gemini et pour finir envoie le fichier. C'est plus simple que TCP avant-hier n'est-ce pas ? üòÖ Voici donc une requ√™te standard sur Gemini. C repr√©sente le client et S le serveur. C : gemini :// gemini . circumlunar . space /docs/ faq . gmi S : 20 text / gemini S : # Hey ! S : This is a website running under Gemini : D J'ai volontairement omis toute la partie correspondant √† TLS dans l'exemple de requ√™te ci-dessus car TLS fera l'objet d'un article plus complet dans peu de temps. Afin de se rendre ind√©pendant de CA externes qui, comme on l'a vu sont un SPOF (single point of failure, point unique de d√©faillance) qui, si il se trouve compromit, pourrait d√©livrer des certificats frauduleux Gemini s'appuie sur le principe de TOFU, Trust on first use, c'est un m√©chanisme aussi utilis√© par SSH par exemple, pour faire confiance √† un certificat, le logiciel s'appuie simplement sur le certificat qu'il a crois√© pour la premi√®re fois sur ce site. Cette fa√ßon de fonctionner est d√©cri√©e par certains pr√©f√©rant un fonctionnement avec CA. Cependant, des m√©canismes comme DANE coupl√© √† DNSSEC existent et permettent de rendre relativement s√©curis√© Gemini. √Ä l'occasion de ce post, j'ai rendu mon blog accessible sur Gemini, je vous invite √† faire un tour dessus √† l'adresse gemini://eban.bzh vous trouverez ici une liste de clients Gemini.","tags":"misc","url":"https://ilearned.eu.org/gemini.html","loc":"https://ilearned.eu.org/gemini.html"},{"title":"Le protocole IRC","text":"Hier nous avions vu le protocole TCP, aujourd'hui nous allons en reparler en l'appliquant concr√®tement. Le protocole que nous allons voir est IRC qui est tr√®s simple dans sa conception, ce qui permet de l'utiliser √† la main sans se prendre trop la t√™te. IRC est l'acronyme d'Internet Relay Chat (traduit litt√©ralement par relai de discussion internet), comme son nom l'indique, le serveur ne fait que relayer les messages, il ne les stocke pas contrairement √† de nombreux autres protocoles de chat. Comme sous entendu juste au dessus, IRC fonctionne dans un mode client serveur, le client est identifi√© par un \"nick\" (diminutif de nickname, pseudo), personne n'aura donc le m√™me nick sur un serveur IRC. Le nick est le seule moyens d'identification d'un client, pour √©viter de se le faire voler il faut laisser un client tourner en continu. Ce fonctionnement n'est pas forc√©ment pratique et facilite l'usurpation, pour palier √† √ßa beaucoup de serveur donnent la possibilit√© de s'authentifier √† l'aide d'un mot de passe soit via un bot √† qui on doit envoyer un message sp√©cifique contenant le secret, soit via un syst√®me appel√© SASL qui permet d'envoyer directement le mot de passe durant la phase de connexion au serveur. Pour ce qui est de l'usage principal de IRC, c'est √† dire les messages, on fonctionne via des canaux, un peu comme discord, identifi√©s par une chaine de texte commen√ßant par \"#\", chaque canal peut poss√©der une description (cela reste facultatif). Pour essayer IRC on peut utiliser telnet qui est un outil qui permet d'√©tablir des connexions TCP, on peut se connecter via la suite de commande : telnet irc.example.org 6667 USER utilisateur * * :Une description NICK utilisateur #D√©finit le fameux nick JOIN \\# canal #Pour joindre un canal PRIVMSG \\# canal Un message #Envoi \"Un message\" dans #canal # Le serveur r√©ponds par le \"MOTD\" (messaye of the day, ou message du jour en fran√ßais) Ce qui donnera la sortie : % telnet irc.lab.rameul.eu 6667 Trying 172 .17.0.2... Connected to irc.lab.rameul.eu. Escape character is '&#94;]' . :irc.lab.rameul.eu NOTICE Auth :*** Looking up your hostname... :irc.lab.rameul.eu NOTICE Auth :*** Could not resolve your hostname: Domain name not found ; using your IP address ( 172 .17.0.1 ) instead. USER ramle * * : NICK ramle :irc.lab.rameul.eu NOTICE Auth :Welcome to rml-lab! :irc.lab.rameul.eu 001 ramle :Welcome to the rml-lab IRC Network ramle!ramle@172.17.0.1 :irc.lab.rameul.eu 002 ramle :Your host is irc.lab.rameul.eu, running version InspIRCd-2.0 :irc.lab.rameul.eu 003 ramle :This server was created on Debian :irc.lab.rameul.eu 004 ramle irc.lab.rameul.eu InspIRCd-2.0 iosw biklmnopstv bklov :irc.lab.rameul.eu 005 ramle AWAYLEN = 200 CASEMAPPING = rfc1459 CHANMODES = b,k,l,imnpst CHANNELLEN = 64 CHANTYPES = # CHARSET=ascii ELIST=MU FNC KICKLEN=255 MAP MAXBANS=60 MAXCHANNELS=20 MAXPARA=32 :are supported by this server :irc.lab.rameul.eu 005 ramle MAXTARGETS = 20 MODES = 20 NETWORK = rml-lab NICKLEN = 32 PREFIX =( ov ) @+ STATUSMSG = @+ TOPICLEN = 307 VBANLIST WALLCHOPS WALLVOICES :are supported by this server :irc.lab.rameul.eu 042 ramle 476AAAAAK :your unique ID :irc.lab.rameul.eu 375 ramle :irc.lab.rameul.eu message of the day :irc.lab.rameul.eu 372 ramle :- :irc.lab.rameul.eu 372 ramle :- _ __ _ __ ___ | | _ __ ___ | | _ :irc.lab.rameul.eu 372 ramle :- | '__| ' _ ` _ \\| | _____ | ' _ \\ / _ \\ __ | :irc.lab.rameul.eu 372 ramle :- | | | | | | | | | _____ | | | | __/ | _ :irc.lab.rameul.eu 372 ramle :- | _ | | _ | | _ | | _ | _ | | _ | | _ | \\_ __ | \\_ _ | :irc.lab.rameul.eu 372 ramle :- :irc.lab.rameul.eu 372 ramle :- Description : Lab :irc.lab.rameul.eu 372 ramle :- NetAdmin : ramle :irc.lab.rameul.eu 372 ramle :- :irc.lab.rameul.eu 376 ramle :End of message of the day. :irc.lab.rameul.eu 251 ramle :There are 1 users and 0 invisible on 1 servers :irc.lab.rameul.eu 254 ramle 0 :channels formed :irc.lab.rameul.eu 255 ramle :I have 1 clients and 0 servers :irc.lab.rameul.eu 265 ramle :Current Local Users: 1 Max: 2 :irc.lab.rameul.eu 266 ramle :Current Global Users: 1 Max: 2 JOIN #article :ramle!ramle@172.17.0.1 JOIN :#article :irc.lab.rameul.eu 353 ramle = #article :ramle @ramle2 :irc.lab.rameul.eu 366 ramle #article :End of /NAMES list. PRIVMSG #article o/ :ramle2!ramle2@172.17.0.1 PRIVMSG #article :o/ ~~Pour ceux qui souhaiteraient tester par eux m√™me avec telnet, le serveur IRC ne sera up qu'√† partir de 21h30 ;).~~ Il est en ligne. On peut voir dans ce court exemple plusieurs choses, d√©j√† la simplicit√© du protocole, en seulement 3 commande on rejoint un canal. Un autre fait qui peut √™tre not√©, c'est la commande envoy√©e pour d√©finir le nom d'utilisateur : USER ramle * * : , il n'y a en effet pas de description, c'est une option facultative. Un autre point important est le symbole \"@\" devant l'utilisateur \"ramle2\", ce caract√®re signifie qu'il est \"op\" c'est √† dire avec les permissions compl√®te sur le canal, il peut donc expulser un membre, le bannir ou modifier des param√®tres sur le canal, il ne peut par contre pas supprimer de messages vu que le serveur ne stocke rien, il ne sert que de relai entre les utilisateurs. Sur la capture r√©seau, on peut observer le peu de requ√™te pour chaque √©tape, l'envoi du contenu en lui m√™me et l'accus√©. Si vous voulez observer par vous m√™me, le fichier est ici irc.pcap C'est tout pour IRC, j'esp√®re que √ßa vous aura plus. N'h√©sitez pas √† poster en commentaire si vous avec des remarques, des questions, on se retrouve demain pour Gemini :)","tags":"misc","url":"https://ilearned.eu.org/irc.html","loc":"https://ilearned.eu.org/irc.html"},{"title":"Comprendre le protocole TCP","text":"Aujourd'hui on s'attaque √† un gros morceau, le protocole TCP , vous √™tes pr√™t¬∑e¬∑s ? C'est partit ! ;) TCP (= Transmission Control Protocol) est le protocole de couche 4 le plus utilis√© et il fait partie int√©grante de nos vies sans que nous ne nous en rendions compte. TCP a √©t√© cr√©√© afin de r√©pondre √† une probl√©matique simple, permettre la communication de fa√ßon fiable entre deux machines. TCP est bas√©, comme de nombreux protocoles, sur une architecture client-serveur . Les donn√©es sont d√©coup√©es en blocs appel√©s segments. La communication s'effectue en trois parties : l'√©tablissement de la connexion, le transfert des donn√©es, la fin de la connexion. Commen√ßons donc par l'√©tablissement de la connexion, il est fait gr√¢ce √† un handshake en trois √©tapes (Three-way handshake), la premi√®re √©tape est nomm√©e SYN (synchronized), le client va donc envoyer un paquet SYN au serveur avec lequel il souhaite entamer la communication, il g√©n√®re aussi al√©atoirement un num√©ro de s√©quence qui est transmit dans ce paquet. Le serveur r√©pond ensuite avec un paquet SYN-ACK (synchronize, acknowledge), litt√©ralement accus√© de r√©ception de la demande de synchronisation , le num√©ro de s√©quence du serveur est g√©n√©r√© al√©atoirement, le num√©ro d'acquittement correspond au num√©ro de s√©quence du client incr√©ment√© d'un. Pour finir, le client envoie un dernier paquet ACK au serveur pour confirmer qu'il a bien re√ßu le paquet SYN-ACK , le num√©ro de s√©quence de ce paquet est √©gal √† celui g√©n√©r√© par le client plus t√¥t + un, le num√©ro d'acquittement quant a lui est √©gal au num√©ro de s√©quence du serveur augment√© de 1. Ne vous en faites pas, nous allons voir plus pr√©cis√©ment √† quoi correspondent les num√©ros d'acquittement et de s√©quence ;). Une fois cette initialisation faite, la communication peut commencer, regardons donc de plus pr√®s le contenu d'un paquet TCP, accrochez vous il y a pas mal de contenu üòÑ. Cette partie s'appuie en grand partie sur l'article wikipedia de TCP . Nous ne d√©taillerons pas l'utilit√© de chacune de ces informations, seulement des plus importantes √† nos yeux. Les num√©ros d'acquittement et de s√©quence sont deux valeurs al√©atoires que l'on incr√©mente avec le nombre de donn√©es re√ßues afin de v√©rifier que tout les paquets sont bien arriv√©es dans l'ordre. Les num√©ros d'acquittement et de s√©quence initiaux sont g√©n√©r√©s al√©atoirement durant la s√©quence d'initialisation de la connexion que nous avons vu plus t√¥t, le three way handshaking. Le partie \"Somme de contr√¥le\" est en fait un condensat des donn√©es transmises qui est calcul√© par le serveur et v√©rifi√© par le client afin de garantir l'int√©grit√© des paquets. Si les hash correspondent on consid√®re alors que le paquet a √©t√© transmit sans erreur. Le flag PSH (push) indique l'envoie de donn√©es. Le flag URG indique la pr√©sence de donn√©es urgentes. Le flag ECN/NS sert quant √† lui √† signaler la pr√©sence de congestion sur le r√©seau. Dans la partie Options on pourrait par exemple citer la MSS (Maximum Segment Size) qui correspond √† la taille maximale de la partie data. Nous avons vu les parties les plus importantes d'un trame TCP, √©tudions maintenant comment fermer une session avec le protocole TCP. Pour fermer une session TCP, c'est relativement simple, le premier appareil envoie un paquet FIN au second avec son num√©ro de s√©quence, afin de v√©rifier que tous les paquets ont √©t√© re√ßu avant de fermer la communication. Le serveur r√©pond alors avec un ACK pour confirmer la r√©ception du message. Le m√™me √©change a ensuite lieu dans l'autre sens, le serveur envoie un paquet FIN et le client r√©pond avec un ACK . Pfiou, √ßa fait beaucoup d'un coup üòÖ. Mettons maintenant tout √ßa en pratique, si vous √™tes arriv√© jusqu'ici, vous avez fait le plus dur, bravo üéâ. Vous remarquerez surement la pr√©sence des mentions de Win ; TSval et TSecr , regardons √† quoi elles correspondent Win correspond √† la fen√™tre, pour faire simple, la taille maximale d'un paquet. TSval et TSecr sont simplement des timestamps , TSval correspond au moment de l'envoi du paquet et TSecr au moment de la r√©ception, chacun des deux participants de la conversation peut soustraire ces deux valeurs pour d√©terminer le Round Trip Time (RTT) , le temps que prend un paquet √† √™tre √©chang√©. Si vous souhaitez √† votre tour inspecter ce simple √©change tcp, le fichier est disponible ici , je vous recommande l'outil Wireshark si vous voulez inspecter des paquets de ce type. Vous l'aurez surement remarqu√©, le protocole TCP a √©t√© con√ßu dans l'optique de minimiser au maximum la perte de donn√©e, gr√¢ce √† des fonctionnalit√© comme les accus√©s de r√©ception ( ACK ) ou la somme de contr√¥le. Mais ces fonctionnalit√©s posent un probl√®me, les paquets s'en retrouvent alourdis, la partie somme de contr√¥le (checksum) p√®se √† elle seule 16 bits par exemple, autre exemple, pour chaque paquet d'envoie de donn√©es ( PSH ), un paquet ACK suppl√©mentaire est n√©cessaire, √† chaque fois ! Cette lourdeur pose notamment probl√®me dans le cadre d'applications en temps r√©el, d'autres protocoles comme UDP que nous √©tudierons bient√¥t ont √©t√© cr√©√©s pour rem√©dier √† ce probl√®me. Merci beaucoup d'√™tre arriv√© jusqu'ici, cet article √©tait plut√¥t complexe j'en suis conscient, si vous avez des question n'h√©sitez surtout pas √† les poser, si vous souhaitez commenter n'oubliez pas que vous pouvez vous connecter (avec le bouton Log In ) via Github, Twitter et Gitlab. √Ä demain üëã","tags":"Today I Learned","url":"https://ilearned.eu.org/tcp.html","loc":"https://ilearned.eu.org/tcp.html"},{"title":"Le soucis du DNS de son op√©rateur","text":"Le soucis du DNS de son op√©rateur Pour le moment, nous avons beaucoup abord√© le DNS, avec diff√©rents moyens de s√©curiser et les risques associ√©s. Aujourd'hui, on va voir comment choisir correctement un r√©solveur, enfin pour √™tre pr√©cis comment savoir le quel ne pas prendre. Je suppose que vous avez r√©solu le NDD (nom de domaine) blog.eban.bzh gr√¢ce au DNS distribu√© par votre box, il y a fort √† parier que vous ne l'ayez pas chang√© et donc que ce soit votre FAI qui r√©ponde aux requ√™tes, le probl√®me √©tant que la plupart des gros FAI ne valident pas les requ√™tes via DNSSEC. Souvent, ces DNS mentent (envoient une r√©ponse volontairement erron√©e, le plus plus souvent pour bloquer des sites.) sur base de demande faite par l'√©tat, les listes sont d'ailleurs priv√©es ce qui permettrai sans soucis de bloquer des sites totalement l√©gitimes, c'est le cas de sci-hub par exemple, une plateforme qui partage des documents scientifiques. % dig @109.88.203.3 sci - hub . se A + short # DNS de VOO , un op√©rateur belge 54.36.19.166 # IPv4 redirigeant vers une page du gouvernement belge % dig A sci-hub.se +short #Utilisation d'un DNS propre 186.2 . 163.219 # IPv4 correct pour le site Il y a aussi un autre probl√®me, la confidentialit√©. En effet, le serveur distant peut voir toutes les requ√™tes faites par un client, dans le cas d'un FAI il peut th√©oriquement savoir pr√©cis√©ment qui vous √™tes. Ils sont (obligation l√©gal) d√©j√† en possession de votre identit√© li√©e √† l'adresse IP. Il reste peut probable que les FAI le fassent vraiment, √ßa leur rajouterai un coup cons√©quent pour le stockage de logs, sans oublier les risques de sanction si il n'est pas stipul√© dans les CGU (conditions g√©n√©rales d'utilisation) ce stockage des requ√™tes. Il y aussi le probl√®me de MITM, les DNS des op√©rateurs n'utilise pas de protocole comme DoH ou DoT, un pirate pourrait donc intercepter les requ√™tes. Dans cet article, on s'est concentr√© sur les op√©rateurs, mais ces probl√®mes existent sur beaucoup de r√©solveur publique qui bien souvent, offrent peu de garantie quand √† la confidentialit√©, ou l'authenticit√© des r√©ponses.","tags":"misc","url":"https://ilearned.eu.org/dns-fai.html","loc":"https://ilearned.eu.org/dns-fai.html"},{"title":"Usage des VLAN","text":"Souvent pour des raisons de s√©curit√© ou par n√©cessit√© de priorisation du flux de certains appareils, il est n√©cessaire de s√©parer le r√©seau en diff√©rentes parties, pour par exemple, s√©parer un r√©seau d'administration de serveurs et du mat√©riel r√©seau avec le r√©seau destin√© aux machines d'une entreprise. Dans ce cas deux solutions sont possible, soit utiliser plusieurs interfaces r√©seaux, soit faire des VLANs. Les VLANs permettent de g√©rer de mani√®re plus ais√©e de la segmentation de r√©seaux, le principe est de par exemple permettre √† un switch r√©seau en fonction du port sur lequel est branch√© une machine d'√™tre sur une VLAN diff√©rente, chaque VLAN poss√®de un ID num√©rique pour l'identifier. Un autre concept int√©ressant des VLAN, c'est le trunk, cela permet de faire passer plusieurs VLAN sur un seul port en tagant les paquets. Ce tag est rajout√© dans l'en-t√™te ethernet il contient l'ID de la VLAN dans laquelle le trafic doit aller. On peut aussi avoir des VLANs dites untagged, c'est √† dire qui ne demande pas la modification de l'en-t√™te ethernet. Une VLAN untagged ne demande pas de configuration sp√©cifique sur le client, c'est la VLAN \"par d√©faut\", contrairement √† une VLAN tagged qui demande que le client rajoute l'information dans l'en-t√™te on ne peut donc avoir qu'une seule VLAN untagged. On peut prendre un exemple du quotidien, la box de votre FAI, si vous avez une box pour la TV par exemple, il y a de forte chance que ce soit une VLAN s√©par√©e, cela permet de prioriser le trafic de la box TV afin d'√©viter des coupures si vous t√©l√©chargez de gros fichiers par exemple. Ici, VLAN 10 est un VLAN taged et VLAN 20 est untagged, tout les appareils passent de base par VLAN 20.","tags":"Today I Learned","url":"https://ilearned.eu.org/vlan.html","loc":"https://ilearned.eu.org/vlan.html"},{"title":"DANE et TLSA - Emp√™cher les certificats TLS frauduleux","text":"Aujourd'hui nous allons √©tudier le protocole DANE, ce protocole a √©t√© cr√©√© pour r√©pondre √† une probl√©matique simple, comment garantir l'authenticit√© d'un certificat TLS si le CA est corrompu et d√©livre un certificat √†, par exemple, un service de renseignement afin qu'il puisse intercepter et d√©chiffrer les requ√™tes des utilisateurs ? Cet exemple n'est pas pris par hasard, un cas similaire s'est produit en 2013 o√π l'ANSSI avait d√©livr√© des certificats pour des domaines de Google, probablement √† des fins de renseignement. La RFC 6698 introduit donc le standard DANE (DNS Authentication of Named Entities) et le record DNS TLSA . Le principe est simple, ajouter un record dans la zone DNS qui contient un condensat du v√©ritable certificat TLS, cette m√©thode ressemble tr√®s fortement au TLS Pinning, √©voqu√© dans l'article d'hier mais a pour sp√©cificit√© de placer le condensat au niveau du DNS. Voici un exemple de record pour blog.eban.bzh : _443._tcp.blog.eban.bzh. 10800 IN TLSA 3 1 1 D7DF5F6E8325454CF25B711D7FCB22CD639C4F26514E5473EC73C59353C16F0D On voit donc que l'on doit sp√©cifier dans le record le port (ici, 443), le protocole utilis√© (ici TCP, en passant, restez √† l'affut dans les prochains jours un article √† propos de ce protocole pourrait sortir üëÄ) puis le domaine auquel il s'applique, les trois num√©ros suivant 3 1 1 correspondent respectivement, √† l'utilit√© du cadre d'utilisation de ce record, ici DANE-EE: Domain Issued Certificate un certificat donn√© pour un nom de domaine. Le 1 suivant indique le type de certificat hash√©, 0 correspondant √† un certificat fullchain et 1 √† la cl√© publique uniquement, le dernier 1 correspond enfin √† la fonction de hashage utilis√©e, ici SHA-256 . Une fois ce certificat mis en place le navigateur devrait, en principe, comparer ce hash avec un hash qu'il g√©n√®rerait de son c√¥t√©, en principe car DANE n'est pr√©sent dans aucun navigateur grand publique . Il existe cependant le module DNSSEC/DANE Validator pour firefox et TLSA Validator pour chromium et d√©riv√©s. Pour r√©sumer le fonctionnement de DANE, voici un petit sch√©ma.","tags":"misc","url":"https://ilearned.eu.org/dane.html","loc":"https://ilearned.eu.org/dane.html"},{"title":"Fonctionnement du DNS over TLS et du DNS over HTTPS","text":"Hier on √©voquait le probl√®me de l'authenticit√© des r√©ponses d'un serveur DNS. Nous avons vu la solution : DNSSEC mais ce m√©canisme ne fait que signer les requ√™tes pour emp√™cher une modification, il n'emp√™che pas un espionnage passif des requ√™tes. Le risque d'espionnage demande de s√©curiser le canal, deux solutions ont √©t√© retenues : DoT et DoH . DoT est l'acronyme de DNS over TLS, ce protocole est assez \"simple\" si on omet l'explication de TLS qui sera vue prochainement, c'est du DNS qui passe par un canal chiffr√© via TLS. On utilise TCP sur le port 853. Un soucis ce pose, TLS se base souvent, comme dans le monde du web avec HTTPS par exemple, sur des autorit√©s de certification (abr√©g√© CA) qui en th√©orie s'assure de d√©livrer des certificat qu'ils ont sign√©s pour prouver la l√©gitimit√©, mais en r√©alit√© ce syst√®me est assez peu fiable, il n'est en effet pas rare de voir une autorit√© d√©livrer par erreur ou m√™me intentionnellement des certificats v√©rol√©s, qui n'aurait pas du sortir, de plus, historiquement un certificat coute assez ch√®re, m√™me si de nos jours certaines organisations comme Let's Encrypt d√©livre gratuitement un certificat TLS. Pour se passer de CA plusieurs solutions existent, la plus simple est tout simplement de ne pas v√©rifier le certificat, cela prot√®ge d'un attaquant \"passif\" mais Il reste relativement ais√© de remplacer le certificat √† la vol√©. Pour emp√™cher ce cas on peut faire de l'√©pinglage de cl√©, ce principe se base sur un condensat du certificat qui est ensuite mit en base64, le logiciel peut ensuite comparer le certificat distant avec la cl√© qu'il a en local si un pirate effectue une attaque de l'homme du milieu (MITM) et remplace le certificat en court de route le client se rendra compte du subterfuge. Un dernier probl√®me dans DoT existe, un pare feu peut facilement en emp√™cher le fonctionnement, dans le cadre de portail captif par exemple souvent seul le trafic HTTP est autoris√©. Une solution pour pallier √† ce probl√®me existe : DNS over HTTPS (DoH). DoH permet comme DoT de chiffrer le canal de communication, mais en passant par HTTPS l'avantage est qu'il est difficilement bloquable, en effet bloquer HTTPS bloquerai par la m√™me occasion un grands nombres de sites web. Le fonctionnement reste ax√© sur le principe d'HTTP, l'avantage d'HTTP est le contr√¥le du cache directement sur le client avec l'en-t√™te Cache-Control: max-age=X (ou X est le temps en seconde). Comme pour DoT plusieurs choix existe pour la validit√© du certificat, ce sont les m√™mes choix qui s'offrent √† nous. Pour ce qui est des codes de retour du DNS ils sont dans le corps du message, et non sous forme de code HTTP, bien sur les codes classiques HTTP sont toujours appliqu√©s. Ces deux m√©thodes peuvent poser soucis dans certains cadre, en effet, il est dans beaucoup de cas requis de passer par un programme qui \"traduit\" de DoH ou DoT vers le protocole DNS directement. Un exemple de logiciel est par exemple stubby sous Linux.","tags":"misc","url":"https://ilearned.eu.org/dot-doh.html","loc":"https://ilearned.eu.org/dot-doh.html"},{"title":"Fonctionnement de DNSSEC","text":"Petit rappel: ce blog a un flux RSS , n'h√©sitez pas √† l'ajouter √† votre lecteur de flux RSS favori :) Hier nous avons vu comment s√©curiser la connexion entre un serveur slave et un serveur master, mais le probl√®me d'authenticit√© des r√©ponses se pose encore, pour commencer le trafic entre le serveur autoritaire et r√©solveur n'est pas chiffr√©, n'importe quel attaquant qui pratique une attaque type MITM peut donc modifier les r√©ponses. Le canal n'est pas le seul probl√®me, surtout qu'il est d√©j√† possible de s√©curiser le canal entre r√©solveur et autoritaire, et entre le r√©solveur et le client via DoT (DNS over TLS) et DoH (DNS over HTTPS), nous en parlerons plus largement demain ;). S√©curiser le canal si le serveur est corrompu ne sert pas √† grand chose, c'est la raison pour laquelle DNSSEC ( RFC 4033 ) a √©t√© invent√©. DNSSEC est une mani√®re de signer de fa√ßon cryptographique une zone DNS sur base d'un syst√®me de cl√©s asym√©triques, un syst√®me de cl√©s asym√©triques repose sur 2 cl√©s, une priv√©e qui est gard√©e pr√©cieusement et qui sert √† signer ou d√©chiffrer des donn√©es et une publique qui sert √† v√©rifier ou chiffrer des donn√©es. Dans le cadre du DNSSEC le chiffrement ne sert pas, la cl√© priv√©e sert donc uniquement √† signer. Pour proc√©der on utilise en g√©n√©ral deux pairs de cl√©s : la KSK (key-signing key) et la ZSK (zone-signing key). La cl√© KSK est seulement l√† pour la signature de la ZSK, on lui donne une dur√©e de vie plus grande que la ZSK et elle peut √™tre stock√©e et g√©n√©r√©e hors ligne pour accroitre la s√©curit√©s de celle ci, l'avantage de ce syst√®me est de pouvoir garder plus longtemps la m√™me cl√© sans rajouter trop de risque de fuite vu que stock√©e hors ligne, dans un lieu s√©curis√©. La ZSK quand √† elle est sert √† signer la zone, elle doit donc √™tre pr√©sente sur la machine qui g√©n√®re la zone, on la change plus souvent pour √©viter les risques de fuites. Les serveurs esclaves n'ont besoin d'aucune des 2 cl√©s, ils re√ßoivent directement la zone sign√©e, la modification de la zone de leur part n'est donc plus possible si le r√©solveur v√©rifie avec DNSSEC. DNSSEC ne signe pas la zone de mani√®re enti√®re, mais signe chaque enregistrement ind√©pendamment, la signature est contenue dans le record de type RSSIG . Ce fonctionnement pose un soucis si il permet de signer une entr√©e DNS, comment prouve t'on inexistante d'un enregistrement ? Pour r√©soudre cette probl√©matique l'enregistrement de type NSEC existe. NSEC est un moyen de prouver l'inexistence (symbolis√© par le code de retour NXDOMAIN ) d'un record en donnant le prochain (par ordre alphab√©tique) enregistrement de la zone, un probl√®me de confidentialit√© se pose avec cet m√©thode, il est en effet tr√®s simple d'√©num√©rer la liste d'enregistrement. Pour emp√™cher ce type d'attaque NSEC3 est n√©, au lieu de donner le FQDN on ne retourne que le condensat, l'√©num√©ration devient donc impossible. Une derni√®re probl√©matique, et pas des moindres existe, comment s'√©changer de mani√®re fiable les cl√©s √† grande √©chelle ? On ne peut pas se les donner de personne √† personne, c'est ing√©rable au vu du nombre de zones pr√©sentes sur internet. Pour r√©soudre cette probl√©matique deux enregistrements existent : DS et DNSKEY. Commen√ßons pas DNSKEY, il permet d'enregistrer la cl√© publique qui signe la zone, cette enregistrement est stock√© dans la zone elle m√™me. Avec uniquement DNSKEY on ne peut pas valider correctement la zone, la fiabilit√© de la chaine n'est pas garantie, il slave pourrait modifier ce record pour modifier la zone √† sa guise, pour v√©rifier il existe donc un enregistrement DS qui se situe dans la zone parente et permet de faire une r√©f√©rence √† la cl√© publique utilis√©e pour signer la zone du FQDN, c'est le registrar qui s'occupe de faire placer cet enregistrement. Pour ce qui est de la zone . il est impossible de d√©finir un record DS au dessus, car c'est la zone la plus basse, l'IANA donne donc la cl√© utilis√©e et c'est disponible ici : https://www.iana.org/dnssec/files . C'est tout pour cet article, j'esp√®re que √ßa vous aura plus. Si vous avez des remarques ou questions n'h√©sitez pas en commentaire. On se retrouve demain pour parler de DNS over TLS et DNS over HTTPS :)","tags":"misc","url":"https://ilearned.eu.org/dnssec.html","loc":"https://ilearned.eu.org/dnssec.html"},{"title":"Comment sont allou√©es les adresses IPs","text":"Internet est un √©norme \"r√©seau de r√©seaux\" et comme toute grande organisation son fonctionnement est relativement complexe, aujourd'hui nous allons tenter de d√©crypter le fonctionnement de l'allocation d'adresse IP sur Internet üôÇ. Vous commencez √† avoir l'habitude, commen√ßons par un sch√©ma. √Ä la t√™te d'Internet, il y a une organisation, l'ICANN (Internet Corporation for Assigned Names and Numbers soit Soci√©t√© pour l'attribution des noms de domaine et des num√©ros sur Internet en fran√ßais) cette entreprise am√©ricaine g√®re les noms de domaine et les adresses IPs via l'IANA qui est un d√©partement de cette institution. Les IPs sont ensuite redistribu√©es entre cinq organisations appel√©s RIRs, L'ARIN pour les pays d'Am√©rique du nord. √Ä qui l'IANA attribue 93 /8 Le LACNIC pour les pays d'Am√©rique du sud. √Ä qui l'IANA attribue 10 /8 L'AFRINIC pour les pays d'Afrique. √Ä qui l'IANA attribue 42 /8 Le RIPE NCC pour l'Europe et le Moyen-Orient? √Ä qui l'IANA attribue 6 /8 L'APNIC pour l'Asie et le Pacifique. √Ä qui l'IANA attribue 51 /8 On remarque donc de grandes in√©galit√©s dans l'allocation des IPs entre les RIRs. Ces RIRs attribuent ensuite eux m√™me des plages d'IPs √† de LIRs (Local Internet Registry ou registre Internet local), nous prendrons ici l'exemple de iFog GmbH qui est un LIR d√©clar√© apr√®s du RIPE NCC. Les LIRs sont des interm√©diaires entre les RIR et les AS. Nous en venons donc √† notre dernier point, les AS (Autonomous System) sont des entit√©s identifi√©es par un num√©ro de 32 bits (ou 16 avant 2007 ou dans certains cas aujourd'hui), ces num√©ros sont appel√©s ASN (Autonomous System Number), promit c'est le dernier acronyme üòõ, ce sont ces AS qui peuvent avoir des ranges d'IPs, par exemple l'AS213253 a le range 2a0c:9a40:81fb::/48 qui lui est attribu√© par l'interm√©diare d'iFog GmbH, cette AS poss√®de aussi 2a0e::fd45::2a00::/40 qui lui est attribu√© par un autre LIR : Bakker IT. Il faut savoir qu'un AS est couteux, pour vous donner un ordre d'id√©e le co√ªt approximatif d'un AS √† l'ann√©e est d'environ 4000‚Ç¨ en prenant en compte le transit, les IPs etc. Merci d'avoir lu cet article qui, je l'esp√®re vous aura √©clair√© sur le fonctionnement d'Internet ;) Si vous avez des questions n'h√©sitez pas √† les formuler dans les commentaires, on se retrouve demain pour parler de DNSSEC.","tags":"misc","url":"https://ilearned.eu.org/allocation-ips.html","loc":"https://ilearned.eu.org/allocation-ips.html"},{"title":"S√©curiser la connexion entre Master et Slave","text":"Comme nous l'avons vu hier , la communication entre master et slave est faite en claire ce qui peut repr√©senter une probl√®me de s√©curit√©, plusieurs syst√®mes ont donc √©t√© mit en place afin de s√©curiser ce syst√®me. Le filtrage par IP Le moyen le plus courant pour filtrer les demandes de transfert de zone est le filtrage par IP, mais il pr√©sente deux inconv√©nients principaux, ce filtrage par IP peut poser probl√®me dans le cas o√π le slave aurait un IP dynamique et pose aussi un probl√®me de s√©curit√© d√ª au fait qu'une IP puisse √™tre \" spoof√© \" (= usurp√©e), ce type d'attaque fera tr√®s probablement l'objet d'un article dans un futur proche üòâ. Le protocole TSIG Le protocole TSIG , introduit en Mai 2000 par la RFC 2845 (pour info, une RFC, requests for comments, est un documents qui d√©taille le fonctionnement d'Internet ou de diff√©rents mat√©riels informatique) permet d'authentifier un slave gr√¢ce √† un secret partag√©, le slave envoie un premier paquet contenant un condensat (hash) de la cl√©, le master compare alors ce hash avec celui qu'il g√©n√®re aussi de son c√¥t√© √† partir de cette m√™me cl√©, s'ils correspondent et que les id (= nom de la cl√©) sont identiques le slave est authentifi√©, pour r√©sumer cela, voici un sch√©ma. Ce protocole a cependant deux tares, premi√®rement, la cl√© doit √™tre partag√©e pour la premi√®re fois de fa√ßon s√©curis√©e, ce qui n'est pas toujours chose facile, deuxi√®me tare, l'authentification est bien s√©curis√©e, mais c'est moins le cas pour les requ√™tes AXFR/IXFR qui sont seulement sign√©e, ainsi, l'int√©grit√© de la r√©ponse peut √™tre assur√©e mais son contenu transite en clair sur internet, il existe cependant un autre projet de protocole qui pourrais permettre de s√©curiser ces √©changes. XFR over TLS Le protocole XoT (XFR over TLS) est encore √† l'√©tat de \"draft\" (brouillon) mais il permettrait de pallier √† ce probl√®me en chiffrant les requ√™tes gr√¢ce au protocole TLS. Il existe malgr√© tout une impl√©mentation exp√©rimentale de XoT dans le logiciel Bind , XoT est donc un protocole tr√®s prometteur afin de garantir la confidentialit√© des transferts de zone. Merci d'avoir lu cet article, on se retrouve demain pour parler de l'allocation des adresses IP sur internetüôÇ.","tags":"Today I Learned","url":"https://ilearned.eu.org/tsig-xot.html","loc":"https://ilearned.eu.org/tsig-xot.html"},{"title":"Communication entre Master et Slave - Vuln√©rabilit√© transfert de zone","text":"Aujourd'hui, on parle des procotoles AXFR et IXFR ainsi que de la vuln√©rabilit√© que peut repr√©senter un transfert de zone non autoris√© ! AXFR est un protocole qui sert √† faire des transferts de zone du master vers le slave , le slave v√©rifie p√©riodiquement si le serial (=num√©ro de version, voir ici si vous ne vous rappelez plus de ce que c'est) de son SOA est inf√©rieur √† celui du master , si c'est le cas, il fait une demande de transfert de zone, qui peut √™tre fait gr√¢ce au protocole AXFR. Concr√®tement le master envoie simplement une copie de sa zone DNS vers le slave . Il existe aussi un autre protocole pour le m√™me usage appel√© IXFR, avec IXFR, si le slave remarque que son serial est inf√©rieur √† celui du master , il envoie le serial de la version de la zone qu'il d√©tient au master , le master envoie ensuite le nouveau serial et deux listes, une pour les records √† supprimer et une autre pour les records √† ajouter/modifier. IXFR a pour avantage principal de n√©cessiter moins de bande passante qu'AXFR. Un fois ces petites explications faites, passons √† la partie la plus int√©ressante, l'exploitation d'un transfert de zone :p. Pour authentifier un slave on effectue souvent un filtrage par IP, n√©anmoins il arrive que ce filtrage ne soit pas mit en place, n'importe qui peut alors dumper (= avoir une copie) de la zone tr√®s facilement, voici un exemple que vous pouvez essayer de reproduire chez vous. Nous allons dans un premier temps demander √† notre serveur DNS r√©solveur la liste des serveurs DNS autoritaires pour le domaine zonetransfer.me . L'option +short que j'ai ajout√© ici permet simplement d'avoir directement le r√©sultat sans d'autres informations. ‚û§ dig zonetransfer.me NS +short nsztm1.digi.ninja. nsztm2.digi.ninja. Nous avons donc ici les deux serveurs DNS autoritaires du nom de domaine zonetransfer.me . Essayons donc de faire une requ√™te DNS de type AXFR sur un de ces deux serveurs. ‚û§ dig axfr @nsztm2.digi.ninja zonetransfer.me ; <<>> DiG 9 .11.28-RedHat-9.11.28-1.fc33 <<>> axfr @nsztm2.digi.ninja zonetransfer.me ; ( 1 server found ) ;; global options: +cmd zonetransfer.me. 7200 IN SOA nsztm1.digi.ninja. robin.digi.ninja. 2019100801 172800 900 1209600 3600 zonetransfer.me. 300 IN HINFO \"Casio fx-700G\" \"Windows XP\" zonetransfer.me. 301 IN TXT \"google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA\" zonetransfer.me. 7200 IN MX 0 ASPMX.L.GOOGLE.COM. zonetransfer.me. 7200 IN MX 10 ALT1.ASPMX.L.GOOGLE.COM. zonetransfer.me. 7200 IN MX 10 ALT2.ASPMX.L.GOOGLE.COM. zonetransfer.me. 7200 IN MX 20 ASPMX2.GOOGLEMAIL.COM. zonetransfer.me. 7200 IN MX 20 ASPMX3.GOOGLEMAIL.COM. zonetransfer.me. 7200 IN MX 20 ASPMX4.GOOGLEMAIL.COM. zonetransfer.me. 7200 IN MX 20 ASPMX5.GOOGLEMAIL.COM. zonetransfer.me. 7200 IN A 5 .196.105.14 zonetransfer.me. 7200 IN NS nsztm1.digi.ninja. zonetransfer.me. 7200 IN NS nsztm2.digi.ninja. J'ai volontairement coup√© une bonne partie de la r√©ponse car elle serait trop longue sinon. Nous pouvons donc voir que nous arrivons √† avoir une copie de la zone DNS compl√®te, copie que nous ne devrions normalement pas avoir car elle peut comporter des informations sensibles comme par exemple des sous-domaines cens√©s rester en interne ou des record PTR (les enregistrements PTR associent une IP √† un nom de domaine) qui permettraient de trouver des IPs √† analyser. Et voil√† concr√®tement ce que donne une requ√™te AXFR sur le r√©seau : 10 .2.0.2.36871 > 34 .225.33.2.53: Flags [ P. ] , cksum 0xa73b ( correct ) , seq 1 :59, ack 1 , win 502 , options [ nop,nop,TS val 3406917213 ecr 943752624 ] , length 58 38384 [ 1au ] AXFR? zonetransfer.me. ( 56 ) 34 .225.33.2.53 > 10 .2.0.2.36871: Flags [ . ] , seq 1 :1441, ack 59 , win 489 , options [ nop,nop,TS val 943753618 ecr 3406917375 ] , length 1440 38384 *- 51 /0/1 zonetransfer.me. SOA nsztm1.digi.ninja. robin.digi.ninja. 2019100801 172800 900 1209600 3600 , zonetransfer.me. HINFO, zonetransfer.me. TXT \"google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA\" , zonetransfer.me. MX ASPMX.L.GOOGLE.COM. 0 , zonetransfer.me. MX ALT1.ASPMX.L.GOOGLE.COM. 10 , zonetransfer.me. MX ALT2.ASPMX.L.GOOGLE.COM. 10 , zonetransfer.me. MX ASPMX2.GOOGLEMAIL.COM. 20 , zonetransfer.me. MX ASPMX3.GOOGLEMAIL.COM. 20 , zonetransfer.me. MX ASPMX4.GOOGLEMAIL.COM. 20 , zonetransfer.me. MX ASPMX5.GOOGLEMAIL.COM. 20 On voit donc que les informations transitent en clair (= non chiffr√©es) sur le r√©seau. C'est tout pour aujourd'hui merci beaucoup d'avoir lu cet article, n'h√©sitez pas √† laisser un commentaire si vous avez des remarques √† faire dessus, on se retrouve demain pour parler de comment s√©curiser la communication entre master slave . üëã","tags":"Today I Learned","url":"https://ilearned.eu.org/xfr-zone-transfer.html","loc":"https://ilearned.eu.org/xfr-zone-transfer.html"},{"title":"Le principe de Master/Slave - Le r√¥le du registrar","text":"Aujourd'hui, on parle du r√¥le d'un Registrar puis dans une seconde partie du principe de Master/Slave dans le cadre de serveur DNS autoritaire. Les registrars ou bureaux d'enregistrement en fran√ßais sont des organisations qui g√®rent les domaines de premier niveau (TLD). On peut citer par exemple EURid qui g√®re le .eu , DNS Belgium pour le .be ou encore l'AFNIC pour le .fr . Ces registrars obtiennent leurs domaines de premier niveau aupr√®s de l'IANA. je suppose que vous vous demandez ce qu'est l'IANA ? L'IANA est une branche de l'iCANN, c'est la branche qui g√®re l'attribution de ressource comme les blocs d'IP ou les TLD. Pour ce qui est de la revente de domaines, souvent les bureaux d'enregistrements passent par des sous-traitants, ces sous-traitants doivent respecter certaines r√®gles comme par exemple un prix fixe revers√© au registrar, ou des restrictions g√©ographiques. Le principe de Master/Slave Le principe de master et de slave est assez important dans le monde du DNS et de l'informatique en g√©n√©ral, il permet, dans le cadre du DNS, de redonder facilement une zone sur plusieurs serveurs autoritaires. Le serveur dit master (ma√Ætre) est celui qui contr√¥le la zone, il poss√®de le fichier \"original\". Dans certains contextes, comme pour √©viter la corruption de tous les serveurs en cas d'erreur sur le ma√Ætre, on utilise plusieurs serveurs masters, il n'y a plus une seule zone \"original \" mais plusieurs, le d√©savantage d'un tel syst√®me c'est qu'on est oblig√© de mettre √† jour chaque serveurs master manuellement . Le serveur dit slave (esclave) est celui qui re√ßoit la zone depuis un serveur master, ce transfert de zone DNS utilise des protocoles comme AXFR ou IXFR mais √ßa c'est pour demain üòâ. Ce concept de master/slave permet de redonder une zone bien plus facilement que si on le faisait manuellement.","tags":"misc","url":"https://ilearned.eu.org/master-slave-registrar.html","loc":"https://ilearned.eu.org/master-slave-registrar.html"},{"title":"Les bases du DNS","text":"Pour ce premier post dans la cat√©gorie Today I Learned , on repart des bases, aujourd'hui on parle de DNS üòÑ. Pour les lecteurs les plus exp√©riment√©s connaissant d√©j√† bien les bases du syst√®me de DNS, rendez-vous demain üòâ. Les pr√©requis pour aborder cet article sont : des petites bases de r√©seau , la notion d'IP, de nom de domaine, et √ßa devrait suffire :) Vous trouverez √† chaque fois en d√©but d'article une petite \"carte mentale\" repr√©sentant les sujets que nous aurons d√©j√† abord√© en lien avec cet article, afin que vous puissiez avoir un acc√®s plus facile aux pr√©-requis il suffit de cliquer sur le nom de l'article ou de la notion dans le sch√©ma pour avoir le lien. Le DNS (Domain Name System) est un protocole permettant de \"traduire\" un nom de domaine en une adresse IP . Il existe deux types de serveurs DNS, les serveurs DNS r√©solveur, aussi appel√©s r√©curseurs (comme 1.1.1.1 ou 80.67.169.40 par exemple) servent √† \"traduire\" un nom de domaine en adresse IP, et les serveurs DNS autoritaires, ce type de serveur DNS \"fait autorit√©\" sur une zone DNS (une zone DNS c'est l'ensemble des enregistrement DNS, une sorte de base de donn√©e qui fait la relation entre nom de domaine et IP), c'est √† lui que vont se r√©f√©rer les serveurs DNS r√©solveurs pour associer nom de domaine et IP. √áa fait beaucoup de termes d'un coup üòÖ pour rendre √ßa plus clair voici un petit sch√©ma et les d√©finitions. DNS Domain Name Syst√®me, protocole servant √† traduire un nom de domaine en une adresse IP Zone DNS Ensemble des enregistrement DNS, sorte de base de donn√©e qui fait la relation etre nom de domaine et IP Serveur DNS r√©curseur Serveur DNS \"interm√©diaire\" qui fait office de passerelle etre les serveurs DNS autoritaires et l'utilisateur Serveur DNS autoritaire Contient tout les enregistrement DNS d'une zone. Vous l'imaginez bien, les informations ne sont pas stock√©es tel-quel sur les serveurs DNS, ils sont stock√© sous forme d'enregistrement DNS, en voici un exemple comment√© tout droit tir√© de mon propre serveur DNS autoritaire. eban.bzh. 1800 IN A 89.234.156.60 eban.bzh. correspond au domaine que nous avons demand√©, vous vous demanderez s√ªrement, mais pourquoi y a-t-il un . √† la fin ? Comment √ßa vous ne vous √™tes pas pos√© la question ? üòõ En fait, la r√©solution des DNS fonctionne sous forme de couches, voici un petit sch√©ma qui explique tout √ßa Les serveurs DNS \"root\" correspondent √† la premi√®re couche, ils contiennent les records DNS pour tous les TLD Un TLD ? Qu√®saco ? Un TLD (Top level domain name) c'est en fait tout les . quelque chose que vous rencontrez au quotidien, bzh , fr , com , be en sont quelques exemples. Les serveurs DNS root contiennent donc les record correspondants aux TLD. Les TLD, bzh. dans notre exemple, contient quant √† lui les informations sur les domaines de sa zone, *.bzh. . eban.bzh. pour finir contient tout les records pour eban.bzh. et tout ses sous-domaines ( git.eban.bzh. , blog.eban.bzh. ‚Ä¶) cette \"couche\" est appel√©e FQDN (Fully Qualified Domain Name). Pour rendre tout √ßa plus simple voici (√† nouveau :p) un petit sch√©ma. Et voil√† le sch√©ma corrig√© d'une requ√™te DNS. Ces petites explications faites, continuons avec notre record eban.bzh. 1800 IN A 89.234.156.60 . 1800 correspond au TTL (Time to Live) de ce record, c'est le temps en secondes apr√®s lequel le serveur DNS r√©solveur devra r√©interroger le serveur DNS autoritaire afin de mettre √† jour son cache. Le serveur DNS r√©solveur gardera donc ce record en cache pendant 1800 secondes puis r√©interrogera le serveur DNS autoritaire √† la prochaine requ√™te si ce temps est pass√©. IN A correspond au type du record, ici A qui correspond √† un record qui renvoie une adresse IPv4, il existe de nombreux autres types de records, vous trouverez ci-dessous une liste des plus courants. 89.234.156.60 enfin correspond √† l'adresse IP qui nous est renvoy√©e. Type D√©finition Exemple A Renvoie une Ipv4 eban.bzh. 1800 IN A 89.234.156.60 AAAA Renvoie une Ipv6 eban.bzh. 1800 IN AAAA 2a03:7220:8083:3c00::1 CNAME Renvoie vers un autre record blog.eban.bzh. 1800 IN CNAME veil.eban.bzh. NS Sp√©cifie les NS d'une zone eban.bzh. 1800 IN NS ns1.eban.bzh. MX Indique les serveurs SMTP (mail) √† utiliser eban.bzh. 1800 IN MX 10 spool.mail.gandi.net. SOA Contient les informations suivantes, dans l'ordre : Serveur DNS autoritaire principal Email de contact , le @ est remplac√© par un point, l'adresse ici est donc ns@eban.bzh Serial \"version\" de la zone Refresh d√©lai en secondes entre demandes d'update des slaves Retry d√©lai en secondes entre demandes d'update lors d'un fail Expire expiration de la zone Minimum TTL TTL pour les records inexistants eban.bzh. 86400 IN SOA ns1.eban.bzh. ns.eban.bzh. 1618240745 10800 3600 604800 10800 Si vous voulez essayer d'interroger les serveurs DNS √† la main, dig(1) est un bon outil, il existe aussi la commande nslookup pour les h√©r√©tiques personnes sous Windows. Pour les plus curieux, voici un petit bonus :) Nous allons analyser ce qui se passe concr√®tement sur un r√©seau local lors d'un requ√™te DNS vers un serveur DNS r√©solveur. Cette petite analyse est faite sur un syst√®me bas√© sur linux mais est aussi valable pour Windows. J'ai donc captur√© le trafic sortant de ma machine avec un outil nomm√© tcpdump(8) . Et voici ce que l'on obtient 10 : 31 : 13.272734 IP 10.2 . 0.2 . 60081 > 10.0 . 0.1 . 53 : proto UDP A ? eban . bzh . ( 37 ) 10 : 31 : 13.309725 IP 10.0 . 0.1 . 53 > 10.2 . 0.2 . 60081 : proto UDP A 89.234 . 156.60 ( 53 ) On voit donc que l'ordinateur va interroger le serveur DNS (ici sur 10.0.0.1 ) sur le port 53 qui est le port par d√©faut du protocole DNS pour lui demander un record A pour la zone eban.bzh. . On remarque aussi que ce protocole est bas√© sur le protocole UDP que nous √©tudierons s√ªrement d'ici peu longtemps ;). Le serveur DNS r√©pond ensuite √† la demande en renvoyant le type de record (ici A ) et l'adresse IP demand√©e. Voil√†, c'en est finit pour ce premier post de la cat√©gorie Today I Learned, demain nous nous int√©resserons au fonctionnement √† la fonction d'un registrar ainsi qu'au fonctionnement des serveurs DNS autoritaires sur le principe de slave/master .","tags":"misc","url":"https://ilearned.eu.org/les-bases-du-dns.html","loc":"https://ilearned.eu.org/les-bases-du-dns.html"},{"title":"SolarWinds, l'arbre qui cache la for√™t üëæ","text":"Avant propos Cet article a pour but de retracer les √©v√®nements √† propos de la r√©cente attaque dont SolarWinds a √©t√© victime, ces actualit√©s √©tant relativement r√©centes √† l'heure o√π j'√©cris cet article (07/02/2021) des mises √† jour seront s√ªrement apport√©es √† ce dernier. Signal d'alarme Le 8 d√©cembre 2020, Kevin Mandia, PDG de la soci√©t√© FireEye poste un communiqu√© nomm√© FireEye Shares Details of Recent Cyber Attack, Actions to Protect Community dans lequel il informe que l'entreprise a √©t√© victime d'une cyberattaque de la part d'un \"acteur hautement sophistiqu√©\" et que ce dernier avait acc√©d√© √† leur r√©seau interne et vol√© un grand nombre d'outils de Red Team de la soci√©t√©. Ce communiqu√© fait aussi part du fait que sa discipline, sa s√©curit√© op√©rationnelle et ses techniques nous conduisent √† penser que [l'acteur malveillant derri√®re cette attaque] √©tait soutenu par un √©tat Matt Gorham le directeur adjoint de la division cyber du FBI indique dans la foul√©e Le FBI enqu√™te sur l'incident et les premi√®res constatations montrent un acteur avec un haut niveau de sophistication conforme √† un √âtat-nation Ce qui semble donc confirmer les dires de FireEye. Le 08 d√©cembre 2020 √† 20h11, dans un article le New York Times suppute que Ce piratage soul√®ve la possibilit√© que les agences de renseignement russes aient vu un avantage √† monter l'attaque alors que l'attention am√©ricaine - y compris celle de FireEye - √©tait concentr√©e sur la s√©curisation du syst√®me des √©lections pr√©sidentielles. Sans pour autant apporter de preuve tangible. Le 13 d√©cembre 2020, coup de tonnerre, FireEye indique dans ce communiqu√© que l'attaque qu'ils ont subi a √©t√© propag√©e par le syst√®me de mise √† jour d'Orion, un logiciel de gestion de r√©seau √©dit√© par SolarWinds, un cheval de Troie nomm√© Sunburst avait √©t√© ins√©r√© dans les version 2019.4 HF 5, 2020.2 et 2020.2 HF 1 d'Orion. Microsoft, les d√©partements am√©ricains du Commerce, du Tr√©sor, de l'√ânergie et plus encore ont d√©clar√© avoir √©t√© victimes de cette cyberattaque. Un peu de reverse engineering Ce travail d'analyse est en grande partie bas√© sur les travaux de Colin Hardy. Ce malware a √©t√© con√ßu pour √™tre le plus discret possible, lors de la premi√®re ex√©cution, le code malveillant commence par attendre 12 √† 14 jours avant de s'ex√©cuter. Puis, il v√©rifie si le hostname de la machine contient \"solarwinds\" ou \"test\" , ou s'il correspond √† une liste de noms d'h√¥te qui contient, par exemple, swdev.dmz, swdev.local, on peut donc imaginer que l'attaquant a eu acc√®s au r√©seau local de SolarWinds et a pu collecter ces noms d'h√¥te‚Ä¶ Tout cela dans le but d'√©viter que le malware ne se d√©clenche sur un √©mulateur d'un AV et qu'il soit d√©tect√©. Le malware va ensuite v√©rifier si, dans la liste des processus actifs sur la machine, un ou plusieurs correspond √† une liste qui contient les noms de processus d'antivirus (f-secure gatekeeper, carbonblack), de Command and Control (csagent, csfalconcontainer) - probablement afin de ne pas infecter une machine qui le serait d√©j√† - de logiciels de virtualisation (vboxservice) et m√™me d'analyse r√©seau (wireshark, tcpdump). Tout cela dans la but de rester le plus discret possible. Puis, un userID est cr√©√©, il est g√©n√©r√© √† partir du hostname de la machine, du MachineGuid et de l'adresse MAC Le code malveillant fait ensuite appel au domaine avsvmcloud.com , il g√©n√®re une URL avec la fonction suivante Cette URL est compos√©e du domaine eu-west-1.appsync-api.avsvmcloud.com (la eu-west-1 peut aussi √™tre us-west-2 , us-east-1 ou us-east-2 , le choix est fait al√©atoirement) et d'un sous domaine qui est g√©n√©r√© par la fonction DecryptShort √† partir du UserID g√©n√©r√© plus t√¥t et du hostname de la machine. C'est √† partir de ce sous-domaine que la machine communique avec le C2. Je n'irais pas plus loin dans l'analyse de ce malware, la partie communication avec le C2 √©tant relativement complexe et peu int√©ressante selon moi. Conclusion Le 10 juin 2021, le sp√©cialiste en cybers√©curit√© Kaspersky publie un article dans lequel il indique que la backdoor de Sunburst a beaucoup de similitude avec une autre nomm√©e Kazuar, une backdoor qui a √©t√© attribu√©e √† la Russie. Cette attaque pourrait donc etre appuy√©e par le FSB. Le 29 janvier 2021, Brandon Wales, dirigeant du CISA a r√©v√©l√© dans le Wall Street Journal que 30 % des victimes de l'attaque ne seraient pas clientes de SolarWinds, cette attaque pourrait donc etre seulement la face visible d'une grande op√©ration de cyberespionnage. Merci beaucoup d'avoir lu cette article, si vous avez des questions / remarques, n'h√©sitez pas √† m'en faire part ici ou par mail √† contact@eban.bzh","tags":"misc","url":"https://ilearned.eu.org/solarwinds-larbre-qui-cache-la-foret.html","loc":"https://ilearned.eu.org/solarwinds-larbre-qui-cache-la-foret.html"},{"title":"WannaCry, le virus le plus d√©vastateur jamais cr√©√© üëæ","text":"En mai 2017, un virus informatique du nom de WannaCry fait son apparition, il a infect√© quelques 300 000 ordinateurs dans plus de 150 pays ! Trois ans plus tard, revenons ensemble sur le ransomware le plus d√©vastateur jamais cr√©√©. La gen√®se du projet Le 13 ao√ªt 2016, un groupe de hackers d√©nomm√© The Shadow Brokers met en libre t√©l√©chargement sur Tumblr, GitHub et Pastebin de nombreux programmes d'espionnage et de piratage informatique de la NSA dont la faille de s√©curit√© EternalBlue, cette derni√®re permettant une RCE (remote code execution) sur un machine distante √† partir d'un partage SMBv1 (plus d'infos ici ). Cette vuln√©rabilit√© a √©t√© utilis√©e par le malware WannaCry afin de se propager. Ce virus aujourd'hui attribu√© a la Cor√©e du Nord et plus particuli√®rement au groupe Lazarus par de nombreux acteurs tel que le conseiller √† la s√©curit√© int√©rieure des USA Tom Bossert ou le chercheur en cybers√©curit√© Matthieu Suiche interrog√© par Envoy√© Sp√©cial aurait donc √©t√© cr√©√© dans un but lucratif. Fonctionnement du Ransomware Comme vu plus haut, WannaCry se propage tout seul (c'est un virus auto-r√©pliquant ou vers) gr√¢ce √† la faille de s√©curit√© EternalBlue. Une fois execut√© sur la machine, le logiciel se met √† chiffrer tout les fichiers personnels de l'ordinateur avec la m√©thode de chiffrement AES-128 (Une paire de cl√©s RSA est g√©n√©r√©e au lancement du programme, la cl√© priv√©e √©tait utilis√©e pour chiffrer les fichiers). Apr√®s l'infection, une somme √©quivalente √† 300‚Ç¨ (voir 600‚Ç¨ en fonction des cas) en Bitcoin est demand√©e pour d√©chiffrer les fichiers. Il n'existe aucune preuve du fait que les personnes derri√®re WannaCry sont en capacit√© de d√©chiffrer les fichiers. En effet, il est impossible pour les pirates de relier une transaction √† un ordinateur sp√©cifique. Une fois lanc√©, le logiciel installe aussi Tor sur la machine et essaie de se connecter aux serveurs C2 ( Command and Control ) suivants: gx7ekbenv2riucmf.onion 57g7spgrzlojinas.onion xxlvbrloxvriy2c5.onion 76jdd2ir2embyv47.onion cwwnhwhlz52maqm7.onion Un Antidote ? Un groupe de trois experts en s√©curit√© informatique fran√ßais ont cr√©√© logiciel nomm√© Wanakiwi . Cet outil permet de d√©chiffrer les fichiers qui l'ont √©t√© par WannaCry. WannaCry utilise CryptoAPI (les fonctions cryptographiques de Windows) pour g√©n√©rer les cl√©s de chiffrement, cependant ces fonctions inscrivent dans la RAM de l'ordinateur la cl√© priv√©e en claire, WanaKiwi va donc aller chercher dans la RAM des traces de la cl√© priv√©e utilis√©e pour chiffrer les donn√©es. Comment se pr√©munir de ce type d'attaques dans le futur ? On ne le dira jamais assez, mais n'ouvrez jamais de pi√®ces jointes venant d'un destinataire inconnu. Mettez √† jour r√©guli√®rement votre OS, Microsoft propose une fonction tr√®s int√©ressante dans leur suite de s√©curit√© Windows Defender nomm√©e Dispositif d'acc√®s contr√¥l√© aux dossiers . Cet outil permet de contr√¥ler l'acc√®s aux fichiers syst√®mes de Windows et aux donn√©es personnelles des utilisateurs par des programmes, il fonctionne avec un syst√®me de withelist, chaque programme doit donc √™tre autoris√© manuellement pour pouvoir modifier ces fichiers (plus d'infos ici ). Merci d'avoir lu cet article, j'esp√®re qu'il vous aura plu. Je suis preneur de vos retours :) Remerciements Merci √† xeway, 0xThxmxs, Shcanovishka, Sycorax, look, Ramle et Lancelot de m'avoir aid√© pour la relecture. Sources : https://fr.wikipedia.org/wiki/WannaCry https://fr.wikipedia.org/wiki/The_Shadow_Brokers https://docs.microsoft.com/fr-fr/security-updates/SecurityBulletins/2017/ms17-010 https://www.washingtonpost.com/world/national-security/us-set-to-declare-north-korea-carried-out-massive-wannacry-cyber-attack/2017/12/18/509deb1c-e446-11e7-a65d-1ac0fd7f097e_story.html https://yewtu.be/watch?v=Mp3TH5PI6rc https://www.secureworks.com/research/wcry-ransomware-analysis https://fr.wikipedia.org/wiki/Cryptographic_Application_Programming_Interface https://docs.microsoft.com/fr-fr/windows/security/threat-protection/microsoft-defender-atp/evaluate-controlled-folder-access","tags":"Culture Hack","url":"https://ilearned.eu.org/wannacry-le-virus-le-plus-devastateur-jamais-cree.html","loc":"https://ilearned.eu.org/wannacry-le-virus-le-plus-devastateur-jamais-cree.html"},{"title":"Vos mots de passe sont ils vraiment s√©curis√©s üîê","text":"Aujourd'hui, nous utilisons des mots de passe partout, pour d√©verrouiller son t√©l√©phone, son ordinateur, son compte en banque et bien d'autres. Il parait donc indispensable d'avoir des mots de passe forts pour s√©curiser ces comptes. Dans cet article nous allons donc nous pencher sur comment s√©curiser ces pr√©cieux s√©sames. 1) Avoir des mots de passe diff√©rents Il est tr√®s important d'avoir des mots de passe diff√©rents sur chaque compte, imaginez un de vos comptes est pirat√© et votre mot de passe est r√©cup√©r√©, il suffirait donc au pirate de r√©utiliser ce m√™me mot de passe sur tous vos comptes pour y avoir acc√®s‚Ä¶ Etant donn√© qu'il est impossible de retenir des dizaines de mots de passe diff√©rents, les gestionnaires de mots de passe ont √©t√© invent√©s, ils permettent de n'avoir qu'√† retenir qu'un mot de passe, celui de votre gestionnaire ! Il existe de nombreux services de gestionnaires de mots de passe, je vous conseille : https://apps.nextcloud.com/apps/passwords (Si vous avez un cloud Nextcloud, Nexcloud Passwords est le meilleur gestionnaire de mots de passe) https://bitwarden.com/ (Tr√®s bon gestionnaire de mot de passe enti√®rement open source) Il ne vous reste plus qu'√† installer un de ces services sur tout vos appareils. 2) Utiliser des mots de passe vraiment complexes Le meilleur moyen d'avoir des mots de passe s√©curis√©s est d'utiliser des caract√®res sp√©ciaux, traditionnellement on recommande d'utiliser des caract√®res comme @, $ ou *. Il existe cependant une fa√ßon plus facile mais m√©connue d'avoir un mot de passe complexe facilement, les emojis . Beaucoup de services acceptent les emojis comme mot de passe ! En voici une liste : Twitter ‚úÖ Github ‚úÖ Amazon ‚úÖ Discord ‚úÖ Protonmail ‚úÖ Spotify ‚úÖ On peut aussi, pour s√©curiser nos mots de passe, utiliser des caract√®res d'autres alphabets que l'alphabet latin, du cyrillique, des lettres de l'alphabet arabe ou m√™me des caract√®res en Japonais, Cor√©en, en bref tous les charact√®res de la table Unicode. Pour simplifier cette d√©marche de cr√©ation de mot de passe, j'ai fait un petit script Python sur mon Github disponible ici Il est enfin, tr√®s important d'activer l'A2F sur tous vos comptes, je recommande l'app Aegis pour mettre en place cette authentification √† deux facteurs. Il existe aussi des Cl√©s USB A2F ! Plus s√©curis√©es qu'une app sur mobile‚Ä¶ En voici une liste : https://shutuptrackers.com/hardware/authentification.php Remerciements Merci √† Erispar pour la relecture. Merci √† 0x66 de m'avoir donn√© l'id√©e de parler des Cl√©s USB A2F.","tags":"Tutoriel","url":"https://ilearned.eu.org/vos-mots-de-passe-sont-ils-vraiment-securises.html","loc":"https://ilearned.eu.org/vos-mots-de-passe-sont-ils-vraiment-securises.html"},{"title":"Debuter dans l'infosec üë®‚Äçüíª","text":"Dans ce nouvel article, nous allons traiter de la fameuse question La s√©curit√© informatique, ca m'int√©resse, mais par o√π commencer ? Par o√π commencer, la question est vaste mais voici un petit r√©sum√© des pr√©requis n√©cessaires pour commencer dans l'Infosec : Pour commencer dans le monde de la cybersecurit√©, il est recommand√© d'apprendre un language de scripting tel que le python ( voici un tr√®s bon cours venant du site de zeste de savoir , les bases des languages web sont aussi quasi-indispensables ( ici ou l√† vous pourrez trouver un cours sur le html, le css, le js ainsi que le php) il est aussi important d'apprendre les bases du fonctionnement des protocoles r√©seaux les plus courants (voici un cours qui peut vous aider √† comprendre ces protocoles), pour finir, je recommanderais de passer sous une distribution Linux comme Ubuntu ou Arch pour les plus t√©m√©raires et de vous familiariser avec cet OS et au terminal linux. Une fois tout ces prerequis valid√©s, vous pourrez vous entrainer sur Root-Me Sp√©cialisation Apr√®s avoir d√©couvert les bases de ce milieu, vous pourrez vous sp√©cialiser dans certains domaines sp√©cifiques Le RE(Reverse Engineering / R√©tro Ing√©nerie) Le Reverse Engineering est le fait d'√©tudier le fonctionnement d'un programme pour en comprendre le fonctionnement sans avoir le code source de celui-ci. Pour d√©buter dans ce domaine, il est indispensable de connaitre le language C ainsi que de l'assembleur (de pr√©f√©rence x86_64). Vous pourrez alors vous entra√Æner sur des crackme, si vous voulez de l'aide ou seulement discuter de ces sujets, je vous invite √† rejoindre l'un des serveurs discord list√©s ci-dessous. Les CTFs Les CTFs consistent en un machine faite pour √™tre pirat√©e , le but est de devenir administrateur (ou root ) de la machine en utilisant plusieurs failles informatiques. Pour vous entrainer √† cela, je vous invite √† aller sur HackTheBox ainsi que sur Vulnhub . Comme dans le domaine du reverse engineering, si vous avez besoin d'aide pour le CTF n'h√©sitez pas √† rejoindre un serveur discord, parfois les plateformes proposent le leur pour les haxors. Bonus : Ressources Voici une liste non exhaustive de ressources qui pourraient vous aider : https://github.com/wapiflapi/exrs (Exercices de RE) https://root-me.org/ (Challenges toutes cat√©gories) https://www.newbiecontest.org/ (Challenges toutes cat√©gories) https://www.hackthebox.eu/ (Challenges, plus orient√© test d'intrusion) https://www.vulnhub.com/ (VM vuln√©rables) https://www.dailysecurity.fr/ (Blog de Geluchat) https://beta.hackndo.com/ (Blog de pixis) https://www.hacktion.be/ (Blog de Que20) https://inf0sec.fr/ (Blog de Unknow101 orient√© test d'intrusion windows) https://sideway.re/ (Blog de @SideWay'CSS ) https://inshallhack.org/ (Blog de l'√©quipe fran√ßaise de CTF [Inshall'hack] (https://ctftime.org/team/44256)) https://www.google.fr/ (RTFM, la base avant toute question.) http://exploit.education/ (Un bon site pour d√©buter en pwn) Rainbow (Serveur discord parlant d'infosec mais aussi de programmation.) inf0sec (Serveur discord de [@inf0sec1] (https://twitter.com/inf0sec1) parlant de cybers√©curit√©) ret2school (Serveur discord de @nasm_re et de l'√©quipe de CTF, ret2school ) Remerciements : Merci √† SoEasY de m'avoir aid√© pour la d√©finition du RE. Merci √† MorpheusH3x pour la liste des ressources.","tags":"misc","url":"https://ilearned.eu.org/debuter-dans-linfosec.html","loc":"https://ilearned.eu.org/debuter-dans-linfosec.html"},{"title":"Getting started in infosec","text":"In this new article, we will deal with the famous question \"I'm interested in computer security, but where to start?\" Where to start, the question is vast but here is a small summary of the prerequisites necessary to start in Infosec : To start in the world of cybersecurity, it is recommended to learn a scripting language such as Python (here is a very good course coming from the site of zeste de savoir (fr) ), the basics of web languages are also almost essential ( here (fr) or there (fr) you can find a course on html, css, js and php ) it is also important to learn the basics of how the most common network protocols work ( here (fr) is a course that can help you understand these protocols). Finally, I would recommend to switch to a Linux distribution like Ubuntu or Arch for the more adventurous and to familiarize yourself with this OS and the Linux terminal. Once all these prerequisites are validated, you can train on Root-Me. Specialization : After having discovered the basics of this field, you will be able to specialize in certain specific areas. The RE (Reverse Engineering) : Reverse Engineering is the fact of studying the functioning of a program to understand its operation without having the source code of it. To start in this field, it is essential to know the C language ressource (fr) and assembler (preferably x86_64) ressource (fr) . You will then be able to train on crackme, if you want help or just discuss these topics, I invite you to join one of the discord servers listed below. CTFs : The CTFs consist in a machine made to be hacked , the goal is to become administrator (or root ) of the machine by using several computer flaws. To practice this, I invite you to go on HackTheBox and on Vulnhub . As in the field of reverse engineering, if you need help for CTF do not hesitate to join a discord server, sometimes platforms propose their own for haxors. Bonus : Resources Here is a non-exhaustive list of resources that might help you: https://github.com/wapiflapi/exrs (RE exercises) https://root-me.org/ (Challenges: all categories) https://www.newbiecontest.org/ (Challenges: all categories) https://www.hackthebox.eu/ (Rooms penetration test oriented) https://www.vulnhub.com/ (Vulnerable VMs, like hackthebox but locally) https://www.dailysecurity.fr/ (Geluchat's blog) https://beta.hackndo.com/ (pixis's blog) https://www.hacktion.be/ (Que20's blog) https://inf0sec.fr/ (Unknow101's blog about windows penetration testing) https://sideway.re/ (Blog of @SideWay'CSS ) https://inshallhack.org/ (Blog of the french CTF team Inshall'hack ) https://www.google.fr/ (RTFM, the base before any question) http://exploit.education/ (A site that will teach you the basics in pwn) https://cryptopals.com/ (A site that will teach you the basics in crypto) Rainbow (Discord server talking about infosec but also programming) inf0sec (Discord server from @inf0sec1 talking about cybersecurity) ret2school (Discord server from @nasm_re and the ret2school team ) Acknowledgements : Thanks to SoEasY for helping me with the RE definition. Thanks to MorpheusH3x for the list of resources. Translated by MorpheusH3x .","tags":"i18n","url":"https://ilearned.eu.org/getting-started-in-infosec.html","loc":"https://ilearned.eu.org/getting-started-in-infosec.html"},{"title":"AdGuard Home, La s√©curit√© et la vie priv√©e dans votre maison üõ°Ô∏è","text":"Dans ce nouvel article, nous allons traiter du logiciel open-source AdGuard Home qui est un bloqueur de publicit√©s et de trackers qui int√®gre des fonctions suppl√©mentaires tel que le DOH qui permet de chiffrer les requ√™tes DNS de votre r√©seau Wi-Fi ! A quoi bon ? Il est vrai que l'on pourrait se demander √† quoi pourrait servir un tel outil. Laissez moi vous expliquer : quand vous poss√©dez un appareil connect√© √† Internet (t√©l√©phone, tablette, ordinateur, etc.), des trackers enregistrent votre activit√© afin de revendre ces donn√©es √† des annonceurs leur permettant ainsi de faire de la publicit√© cibl√©e. Ces donn√©es peuvent r√©v√©ler beaucoup sur vous, tel que votre localisation, votre situation familiale, votre √©tat de sant√©, etc. C'est pourquoi il est tr√®s important de se prot√©ger de ces trackers. Pr√©requis Pour ce tutoriel, vous aurez besoin : ‚Ä¢ D'un Raspberry Pi disposant d'un module WiFi ‚Ä¢ D'un c√¢ble RJ45 (Ethernet) Et c'est tout ! Tutoriel Dans ce tutoriel nous allons donc voir l'installation de RaspAP qui permet de faire un point d'acc√®s wifi √† partir d'un cable Ethernet branch√© au Raspberry Pi puis nous verrons l'installation de AdGuard Home ainsi que l'activation de la compatibilit√© avec le DOH (DNS over HTTPS qui permet de chiffrer vos requetes DNS). 1) Installation de RaspAP Pour d√©buter l'installation de RaspAP, effectuez la commande suivante sur votre Raspberry Pi sudo apt update && sudo apt upgrade -y && wget -q https://git.io/voEUQ -O /tmp/raspap && bash /tmp/raspap L'installateur va s'ouvrir, il vous demande d'abord dans quel r√©pertoire vous souhaitez installer RaspAP √† moins que vous ne souhaitez le changer, laissez le r√©pertoire de base, r√©pondre oui √† tout (y) sauf au moment o√π il vous sera propos√© d'installer le bloqueur de publicit√©s, nous n'utiliserons pas celui int√©gr√© √† RaspAP car il est moins performant que AdGuard Home. √Ä la derni√®re √©tape, l'installateur vous demandera si vous souhaitez red√©marrer le Raspberry Pi, r√©pondez oui. Une fois votre Raspberry Pi red√©marr√©, vous pourrez vous rendre sur l'interface web de votre Raspberry Pi, √† noter que les identifiants de connexi sont \"admin\"/\"secret\". Pour y acc√©der, tapez juste l'adresse IP locale de votre Raspberry Pi dans votre navigateur, et depuis cette interface, vous pourrez change le SSID (nom du r√©seau), les informations de connexion, etc. Nous avons donc finit d'installer RaspAP, aucune configuration de ce dernier n'est n√©cessaire pour l'instant. 2) Installation de AdGuard Home Pour commencer l'installation de AdGuard Home, entrez la commande suivante sur votre Raspberry Pi wget https://static.adguard.com/adguardhome/release/AdGuardHome_linux_arm.tar.gz && tar -xf AdGuardHome_linux_arm.tar.gz && cd AdGuardHome && sudo ./AdGuardHome -s install Rendez-vous ensuite sur l'interface d'installation qui se situe √† l'adresse. http://IPLOCALEDEMONRASPBERRYPI:3000 Apr√®s avoir cliqu√© sur \"C'est parti\", dans la partie \"Interface web administrateur\", laissez \"Toutes les interfaces\" et changez le port pour, disons par exemple, 1234. Dans la partie \"Serveur DNS\", choisissez 127.0.0.1 √† la place de \"Toutes les interfaces\" et mettez 5300 dans la case port. Cliquez sur le bouton Suivant puis renseignez vos informations de connexion √† l'interface d'administration Une fois cela fait, cliquez sur Suivant puis \"ouvrir le Tableau de bord\", entrez vos identifiants de connexions puis allez dans la section Filtres puis Listes de blocage DNS. Cochez toutes les cases et ajoutez la liste : \"https://raw.githubusercontent.com/hl2guide/Filterlist-for-AdGuard/master/filter_blocklist.txt\" en cliquant sur la bouton Ajouter liste de blocage. Pour finaliser l'installation, rendez-vous sur l'interface d'administration de RaspAP, les identifiants de connexion sont par d√©faut \"admin\"/\"secret\". Puis dans la section DHCP server, cliquez sur Advanced, puis cochez la case \" Only ever query DNS servers configured below\". Renseignez ensuite \"127.0.0.1#5300\" dans la case Add upstream DNS server, puis cliquez sur le bouton + Pour finir, red√©marrez le Point D'acc√®s en cliquant sur le bouton Restart hotspot dans la section \"Hotspot\". Et voil√† ! L'installation de RaspAP et de AdGuard Home est termin√©e ! 3) Bonus : Mise en place du DOH ainsi que d'un VPN Pour mettre en place le DOH, allez sur l'interface d'administration de AdGuard Home puis dans param√®tres, param√®tres DNS, renseignez le DOH de votre choix, dans mon cas, j'ai choisi https://doh.powerdns.org/ Vos requ√™tes DNS sont maintenant chiffr√©es ! Conclusion Et voil√† ! C'est termin√©, vous pouvez maintenant naviguer sur internet sans publicit√©s ni trackeurs ! Veillez √† bien modifier le mot de passe ainsi que le SSID de votre r√©seau wifi ! Vous n'avez plus qu'√† connecter tout les appareils de votre maison au nouveau r√©seau Wi-Fi et ils seront prot√©g√©s √† leur tour ? Si vous avez des questions, n'h√©sitez pas √† me contacter sur twitter @eban_non ou par mail ebandev@protonmail.com. Merci √† Azgar de m'avoir aid√© pour la relecture","tags":"misc","url":"https://ilearned.eu.org/adguard-home-la-securite-et-la-vie-privee-dans-votre-maison.html","loc":"https://ilearned.eu.org/adguard-home-la-securite-et-la-vie-privee-dans-votre-maison.html"},{"title":"Windows security model","text":"Introduction \"Access denied\". If there is a frustrating error, it is surely this one. On Windows we are often confronted with it, especially from an attacking perspective. However, few people understand why this error (or others) interferes with their comfortable use of their operating system. In this article, I will try to give you an overview of the security model used by Windows, mainly the notions of access privilege and access control. Generally speaking, when I talk about Windows objects, I am talking about users, machines, files, or even processes. Security environment To understand what follows, it is necessary to understand what a security context is in our friend Windows. The latter designates a set of attributes or security rules currently in force, as defined by Microsoft. A security context will be translated by a particular data structure defined by the SSPI (\"Security Support Provider Interface\"), a Windows API written in order to interact with the security context, it is used, for example, for authentication. In other words, the security context defines the basic elements of the security system of our favorite OS (if it doesn't, pretend it does). SecurableObject An object is said to be \"securable\" if it has the ability to have a security descriptor. In general, a lot of objects in Windows are SecurableObjects . Processes, registry keys, files/directories, Active Directory objects and many others. They form the core of the interactions between us and the operating system. I mentioned security descriptors, these are simply lists of several characteristics. They contain the SID (\"Security Identifier\", which is a unique identifier) of the owner of the object, the SID of the owner group, and ACLs for \"Access Control Lists\". Security descriptors are usually in the SDDL (\"Security Descriptor Definition Language\") format, which, although not very nice, is actually very practical because it is easy to use (not to understand). Access tokens When a Windows user logs into his local account (or Active Directory) several pieces of information will be stored in the memory. Obviously, it will contain the password digest (except for very unlikely configurations or a relatively old system, in which case it will be the password in clear), his SID , the SID of his group, access privileges (we'll come back to this later) and many other information. All this is gathered in what is called an access token. This is then kept in a special process called LSASS.exe for \"Local Security Autority SubSystem Service\". It is therefore vital and very sensitive. When we interact with the system in any way, a copy of our access token is used. In the case of a file, the information that the access token contains will then be compared with the information in the DACL (which is a list containing the accesses, more on that later) guaranteeing or not an access of a certain value. It can be intended for writing, reading or even for execution. A more interesting case is that of starting a program. Indeed, the latter is launched as a particular user, so it must not bypass this famous access system. This is why processes are considered SecurableObjects , and in this situation, a copy of our token access is also given and when the program interacts with the system, it will do so according to the rights and identity of the connected user. The function CreateProcessA() is a function of the Windows API kernel32.dll which allows to create a new process. Access privileges As mentioned earlier, the access token contains a number of privileges within it. These are assigned to each connection, according to the security rules. More precisely, access privileges are given according to the group to which one belongs, to which one assigns default rights through local GPOs (in gpedit.msc , Computer Configuration , Security Settings , Local Policies , User Rights Assignment ). The list of these privileges is not presented as a classical enumeration, but here is a PowerShell implementation to get a good idea of all these privileges (from PSReflect-Functions ). $SecurityEntity = psenum $ENUM SecurityEntity UInt32 @{ SeCreateTokenPrivilege = 1 SeAssignPrimaryTokenPrivilege = 2 SeLockMemoryPrivilege = 3 SeIncreaseQuotaPrivilege = 4 SeUnsolicitedInputPrivilege = 5 SeMachineAccountPrivilege = 6 SeTcbPrivilege = 7 SeSecurityPrivilege = 8 SeTakeOwnershipPrivilege = 9 SeLoadDriverPrivilege = 10 SeSystemProfilePrivilege = 11 SeSystemtimePrivilege = 12 SeProfileSingleProcessPrivilege = 13 SeIncreaseBasePriorityPrivilege = 14 SeCreatePagefilePrivilege = 15 SeCreatePermanentPrivilege = 16 SeBackupPrivilege = 17 SeRestorePrivilege = 18 SeShutdownPrivilege = 19 SeDebugPrivilege = 20 SeAuditPrivilege = 21 SeSystemEnvironmentPrivilege = 22 SeChangeNotifyPrivilege = 23 SeRemoteShutdownPrivilege = 24 SeUndockPrivilege = 25 SeSyncAgentPrivilege = 26 SeEnableDelegationPrivilege = 27 SeManageVolumePrivilege = 28 SeImpersonatePrivilege = 29 SeCreateGlobalPrivilege = 30 SeTrustedCredManAccessPrivilege = 31 SeRelabelPrivilege = 32 SeIncreaseWorkingSetPrivilege = 33 SeTimeZonePrivilege = 34 SeCreateSymbolicLinkPrivilege = 35 } And yes, 35 privileges is a lot. But what are they for? They allow to perform some system tasks. They should not be confused with ACE (\"Access Control Entry\", which is a right assigned in a DACL ), because the latter defines access to a SecurableObject . For example, the SeBackupPrivilege right is given to any member of the Backup Operators group and allows you to read the contents of a file regardless of its ACLs (unless you are explicitly prohibited from doing so). The SeRestorePrivilege right allows identically to write a file. The SeDebugPrivilege right (reserved to Administrators), allows to access and manipulate the memory of another program, a program we have not launched. It is typically this right that Mimikatz asks for to access the famous password digests kept by LSASS.exe . *You can find a complete list of the rights given by which privilege in the [official Microsoft documentation] (https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants). These privileges are naturally very powerful and you should not neglect their security, who has what. Now, how can I clearly see which privileges I have? The simplest command for this is whoami /all . whoami.exe opens the token of its own process, and as we said earlier, it contains all the information the system needs to complete its tasks, including access to SecurableObjects . Thus, we can see our privileges ( whoami /priv ), our groups ( whoami /groups ), our SID ( whoami /user ) and many others. A small example, once logged in, I launch a PowerShell command prompt and type whoami /priv . By bad luck, the right seems to be disabled. Windows PowerShell Copyright (C) Microsoft Corporation. Tous droits r√©serv√©s. Testez le nouveau syst√®me multiplateforme PowerShell https://aka.ms/pscore6 PS D:\\> whoami /priv Informations de privil√®ges ---------------------- Nom de privil√®ge Description √âtat ============================= ============================================ ========= SeShutdownPrivilege Arr√™ter le syst√®me D√©sactiv√© SeChangeNotifyPrivilege Contourner la v√©rification de parcours Activ√© SeUndockPrivilege Retirer l'ordinateur de la station d'accueil D√©sactiv√© SeIncreaseWorkingSetPrivilege Augmenter une plage de travail de processus D√©sactiv√© SeTimeZonePrivilege Changer le fuseau horaire D√©sactiv√© PS D:\\> So to shut down my computer I have to activate this right. Thanks to some hidden magic I can activate it (in reality I'm just using an implementation of the RtlAdjustPrivilege function of NTDLL.dll , which allows to adjust the privileges for our process, in PowerShell) and we can see that now I can turn off my computer. PS D:\\tools\\PowerShellScript\\PSReflect-Functions> RtlAdjustPrivilege -Privilege SeShutdownPrivilege -Verbose COMMENTAIRES : [RtlAdjustPrivilege] Attempting to enable 'SeShutdownPrivilege' for the current process COMMENTAIRES : [RtlAdjustPrivilege] enable for 'SeShutdownPrivilege' successful PS D:\\tools\\PowerShellScript\\PSReflect-Functions> whoami /priv Informations de privil√®ges ---------------------- Nom de privil√®ge Description √âtat ============================= ============================================ ========= SeShutdownPrivilege Arr√™ter le syst√®me Activ√© SeChangeNotifyPrivilege Contourner la v√©rification de parcours Activ√© SeUndockPrivilege Retirer l'ordinateur de la station d'accueil D√©sactiv√© SeIncreaseWorkingSetPrivilege Augmenter une plage de travail de processus D√©sactiv√© SeTimeZonePrivilege Changer le fuseau horaire D√©sactiv√© PS D:\\tools\\PowerShellScript\\PSReflect-Functions> Except that after a game of \"CS:GO\" with a Russian team the \"ragequit\" would be somewhat boring. That's why it is possible to activate or deactivate privileges. Be careful, these must be contained in our initial access token , otherwise it would be much too easy. When we use a program like \"shutdown.exe\" it will use some functions of the WinAPI ( AdjustTokenPrivileges of advapi32.dll for the curious) to change its privileges, and thus be able to say goodbye to our game won in advance. Access lists There are two types. The first is the SACL for \"System Access Control List\" which is probably the simplest. Indeed, it allows to establish a certain number of rules concerning the access audit to the object carrying this list. You can then define in this list which event, for which user, should be recorded in the event logs. The other type is called DACL for \"Discretionary Access Control List\". The DACL contains a number of ACE (\"Access Control Entry\") which specify the type of right granted to an object. Their structure is quite elementary. In addition, an ACE contains a header determining its type, i.e. access allowed or denied, and other information. The header, in turn, contains the right guaranteed or not. This right is called an access mask. We list what we call the standard rights which are elementary: DELETE is the right to delete the object, granted it wasn't a very complex one. READ_CONTROL is the right to read the SACL/DACL . WRITE_DAC is the right to modify the entries in the DACL , i.e. add ACEs . WRITE_OWNER is the right to modify the owner of an object, the interest being that the owner implicitly has all the desired rights. These standard rights are then used to build what are called generic rights: GENERIC_READ allows, as its name indicates, to read the attributes and properties of an object. If it is a file for example, this right allows to read the content of the file. Its equivalent under linux is the \"r\" flag. GENERIC_WRITE allows the modification of the object's properties and attributes. To continue in the previous example, this right allows the modification of its content. Its linux equivalent is the \"w\" flag. GENERIC_EXECUTE allows to read the permissions of an object. In fact if it is a program, it allows to launch it. Its linux equivalent would be the \"x\" flag. GENERIC_ALL is the combination of these rights. Be careful though, it is significantly stronger, in very rare cases. It may turn out that the combination GENERIC_READ/WRITE/EXECUTE is not equivalent to GENERIC_ALL , so it has no equivalent in the penguin system. There are still a lot of them but the objective is not to be exhaustive. To see these accesses, you have to use the security tab of an object's properties. We can also use our favorite shell aka PowerShell (here you have no excuse because PowerShell is great and opensource). There is a special command for this: Get-Acl . It takes as argument the path to our object, -Path and that's about it for simple use. The result is a \"table\" which is quite uncomfortable. To get rid of this display problem, we use a | pipe to the Format-List command (or its alias fl ). We can then see the owner of the file in our case, the accesses granted and the security descriptor in SDDL format. PS D:\\tools\\PowerShellScript\\PSReflect-Functions> Get-Acl .\\ | fl Path : Microsoft.PowerShell.Core\\FileSystem::D:\\tools\\PowerShellScript\\PSReflect-Functions Owner : DESKTOP-8Q2CUHH\\Lancelot Group : DESKTOP-8Q2CUHH\\Aucun Access : BUILTIN\\Administrateurs Allow FullControl BUILTIN\\Administrateurs Allow 268435456 AUTORITE NT\\Syst√®me Allow FullControl AUTORITE NT\\Syst√®me Allow 268435456 AUTORITE NT\\Utilisateurs authentifi√©s Allow Modify, Synchronize AUTORITE NT\\Utilisateurs authentifi√©s Allow -536805376 BUILTIN\\Utilisateurs Allow ReadAndExecute, Synchronize BUILTIN\\Utilisateurs Allow -1610612736 Audit : Sddl : O:S-1-5-21-1739485902-3336647338-3362325240-1001G:S-1-5-21-1739485902-3336647338-3362325240-513D:(A;ID;FA;;;BA)(A;OICIIOID;GA;;;BA)(A;ID;FA;;;SY)(A;OICIIOID;GA;;;SY)(A;ID;0x1301bf;;;AU)(A;OICIIOID;SD GXGWGR;;;AU)(A;ID;0x1200a9;;;BU)(A;OICIIOID;GXGR;;;BU) PS D:\\tools\\PowerShellScript\\PSReflect-Functions> If you want more details, I invite you to read my article about ACL abuse in ActiveDirectory Let's sum up When a user logs in to his session, information will be kept in memory in an access token . When he wants to start a program, a copy of his token is given. If he interacts with the system, he will have to use his privileges to perform certain operations. If it is not necessary to use them all the time, when we want to access an object (file, process ‚Ä¶) our access token serves as an identity card which will be compared with the contents of the DACL of the security descriptor of the object the program/user wants to access. Depending on the different entries in the access list, it will be denied or allowed a certain access. I hope you now have a better understanding of how the Microsoft OS manages permissions. If you liked this article, I invite you to read my articles on access privileges and on the abuse of ACLs in Active Directory (and yes, even if useful for defenders, they are also useful for attackers). Translated by MorpheusH3x","tags":"i18n","url":"https://ilearned.eu.org/secu_windows-en.html","loc":"https://ilearned.eu.org/secu_windows-en.html"}]};